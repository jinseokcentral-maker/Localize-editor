# 키보드 네비게이션 명세서

## 개요
Locale Editor에서 사용되는 키보드 단축키 및 네비게이션 동작을 정의합니다.

## 기본 원칙
- 편집 가능한 언어 컬럼(values.*)에만 포커스를 이동
- Key, Context 컬럼은 편집 가능하지만, 키보드 네비게이션의 주 대상은 언어 컬럼
- 편집 모드 중과 일반 모드에서의 동작이 다를 수 있음

## 키보드 단축키 명세

### 1. Tab 키
- **기능**: 오른쪽 셀로 이동 (편집 모드로 시작하지 않음)
- **동작**:
  - 현재 셀이 편집 중이면 편집 완료 후 이동
  - **이동 후 셀은 편집 모드가 아님** (일반 포커스만)
  - 같은 행에 오른쪽 컬럼이 있으면 → 오른쪽 컬럼으로 이동 (언어 컬럼 제약 없음)
  - 같은 행의 마지막 컬럼이면 → 다음 행의 첫 번째 컬럼(Key 컬럼)으로 이동
  - 마지막 행의 마지막 컬럼이면 → 첫 번째 행의 첫 번째 컬럼(Key 컬럼)으로 이동 (순환)
- **처리 위치**: `navigateToNextCell` 콜백
- **제약사항**: 모든 컬럼 순회 (Key, Context, Language 컬럼 모두 포함)

### 2. Shift + Tab 키
- **기능**: 이전 편집 가능한 언어 셀로 이동
- **동작**:
  - 현재 셀이 편집 중이면 편집 완료 후 이동
  - 같은 행에 이전 언어 컬럼이 있으면 → 이전 언어 컬럼으로 이동
  - 같은 행의 첫 번째 언어 컬럼이면 → 이전 행의 마지막 언어 컬럼으로 이동
  - 첫 번째 행의 첫 번째 언어 컬럼이면 → 마지막 행의 마지막 언어 컬럼으로 이동 (순환)
- **처리 위치**: `navigateToNextCell` 콜백 (shiftKey 플래그 확인)
- **제약사항**: 언어 컬럼(values.*)만 순회

### 3. Enter 키
- **기능**: 편집 완료 후 아래 행의 같은 언어 셀로 이동 및 편집 시작
- **동작**:
  - 현재 편집 중인 셀을 저장 (onCellValueChanged 이벤트 발생)
  - 편집 모드 종료
  - 아래 행이 있으면 → 아래 행의 같은 언어 컬럼으로 포커스 이동
  - 아래 행이 없으면 → 이동하지 않음 (현재 셀에서 포커스 유지, 편집 모드 종료)
  - 이동 후 자동으로 편집 모드 시작 (startEditingCell)
- **처리 위치**: `onCellEditingStopped` 이벤트 핸들러
- **제약사항**: 언어 컬럼(values.*)에서만 동작
- **참고**: Key, Context 컬럼에서는 AG Grid 기본 동작 (편집 완료만)

### 4. Shift + Enter 키
- **기능**: 편집 완료 후 위 행의 같은 언어 셀로 이동 및 편집 시작
- **동작**:
  - 현재 편집 중인 셀을 저장 (onCellValueChanged 이벤트 발생)
  - 편집 모드 종료
  - 위 행이 있으면 → 위 행의 같은 언어 컬럼으로 포커스 이동
  - 위 행이 없으면 → 이동하지 않음 (현재 셀에서 포커스 유지, 편집 모드 종료)
  - 이동 후 자동으로 편집 모드 시작 (startEditingCell)
- **처리 위치**: `onCellEditingStopped` 이벤트 핸들러 (현재 미구현)
- **제약사항**: 언어 컬럼(values.*)에서만 동작
- **상태**: ⚠️ 미구현 (TODO)

### 5. Esc 키
- **기능**: 편집 취소 (변경사항 저장하지 않음)
- **동작**:
  - 현재 편집 중인 셀의 변경사항을 취소 (원래 값으로 복원)
  - 편집 모드 종료
  - **셀 이동하지 않음** (현재 셀에 포커스 유지)
- **처리 위치**: `onCellKeyDown` + `onCellEditingStopped` (ESC 플래그 확인)
- **제약사항**: 모든 편집 가능한 컬럼에서 동작

### 6. Arrow Keys (방향키)
- **기능**: 셀 간 이동 또는 텍스트 내 커서 이동
- **동작**:
  - **편집 모드 중**: 텍스트 내에서 커서 이동 (AG Grid 기본 동작)
  - **일반 모드**: 인접한 셀로 포커스 이동 (AG Grid 기본 동작)
- **처리 위치**: AG Grid 기본 동작 (커스터마이징 없음)
- **제약사항**: 없음 (모든 컬럼에서 동작)

### 7. Space 키
- **기능**: 셀 선택/편집 시작
- **동작**: AG Grid 기본 동작
- **처리 위치**: AG Grid 기본 동작

### 8. Delete / Backspace 키
- **기능**: 셀 값 삭제
- **동작**:
  - **편집 모드 중**: 텍스트 삭제 (AG Grid 기본 동작)
  - **일반 모드**: 셀 값 전체 삭제 (AG Grid 기본 동작)
- **처리 위치**: AG Grid 기본 동작

## 편집 가능한 컬럼 구분

### 언어 컬럼 (values.*)
- Tab/Shift+Tab 네비게이션 대상
- Enter/Shift+Enter 네비게이션 대상
- 편집 가능

### Key 컬럼
- Tab/Shift+Tab 네비게이션 대상 아님
- Enter/Shift+Enter 네비게이션 대상 아님
- 편집 가능 (자체 키보드 동작만)

### Context 컬럼
- Tab/Shift+Tab 네비게이션 대상 아님
- Enter/Shift+Enter 네비게이션 대상 아님
- 편집 가능 (자체 키보드 동작만)

## 현재 구현 상태

### ✅ 구현 완료
- Tab / Shift+Tab 네비게이션
- Enter 네비게이션 (아래 행으로 이동)
- Esc 키 (편집 취소, 이동 없음)

### ⚠️ 미구현
- Shift+Enter 네비게이션 (위 행으로 이동)

## 버그 및 이슈

### 알려진 버그
1. Shift+Enter가 구현되지 않음
   - 현재 Enter 키만 아래 행으로 이동
   - Shift+Enter는 위 행으로 이동해야 하지만 동작하지 않음

### 예상되는 버그
1. Enter 키 동작이 모든 컬럼에서 일관되지 않을 수 있음
   - 언어 컬럼: 아래 행으로 이동
   - Key/Context 컬럼: AG Grid 기본 동작 (이동 없음)

2. Tab/Shift+Tab이 Key, Context 컬럼에서도 동작할 수 있음
   - 현재는 언어 컬럼만 순회하도록 구현되어 있어야 함
   - 하지만 포커스가 Key/Context 컬럼에 있을 때 Tab을 누르면?

## 테스트 케이스

### Tab 키 테스트
- [ ] 첫 번째 행의 첫 번째 언어 컬럼에서 Tab → 첫 번째 행의 두 번째 언어 컬럼
- [ ] 첫 번째 행의 마지막 언어 컬럼에서 Tab → 두 번째 행의 첫 번째 언어 컬럼
- [ ] 마지막 행의 마지막 언어 컬럼에서 Tab → 첫 번째 행의 첫 번째 언어 컬럼 (순환)

### Shift+Tab 키 테스트
- [ ] 첫 번째 행의 두 번째 언어 컬럼에서 Shift+Tab → 첫 번째 행의 첫 번째 언어 컬럼
- [ ] 두 번째 행의 첫 번째 언어 컬럼에서 Shift+Tab → 첫 번째 행의 마지막 언어 컬럼
- [ ] 첫 번째 행의 첫 번째 언어 컬럼에서 Shift+Tab → 마지막 행의 마지막 언어 컬럼 (순환)

### Enter 키 테스트
- [ ] 첫 번째 행의 언어 컬럼에서 Enter → 두 번째 행의 같은 언어 컬럼으로 이동 및 편집 시작
- [ ] 마지막 행의 언어 컬럼에서 Enter → 이동하지 않음 (편집만 종료)
- [ ] Key 컬럼에서 Enter → 이동하지 않음 (AG Grid 기본 동작)

### Shift+Enter 키 테스트
- [ ] 두 번째 행의 언어 컬럼에서 Shift+Enter → 첫 번째 행의 같은 언어 컬럼으로 이동 및 편집 시작
- [ ] 첫 번째 행의 언어 컬럼에서 Shift+Enter → 이동하지 않음 (편집만 종료)
- [ ] ⚠️ 현재 미구현으로 테스트 불가

### Esc 키 테스트
- [ ] 편집 중 Esc → 편집 취소, 현재 셀에 포커스 유지
- [ ] 변경사항이 있으면 원래 값으로 복원
- [ ] 셀 이동하지 않음

## 구현 상세

### 파일 위치
- `src/components/locale-editor.ts`
- `handleNavigateToNextCell()`: Tab/Shift+Tab 처리
- `handleCellEditingStopped()`: Enter 처리
- `onCellKeyDown`: Esc 키 감지

### 관련 이벤트
- `navigateToNextCell`: Tab/Shift+Tab 네비게이션
- `onCellEditingStopped`: 편집 완료 이벤트
- `onCellKeyDown`: 키보드 입력 감지

