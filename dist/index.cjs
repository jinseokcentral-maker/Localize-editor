Object.defineProperty(exports,Symbol.toStringTag,{value:`Module`});let e=require(`effect`),t=require(`zod`);function n(e,t,n){let r=n.initialDeps??[],i,a=!0;function o(){let o;n.key&&n.debug?.()&&(o=Date.now());let s=e();if(!(s.length!==r.length||s.some((e,t)=>r[t]!==e)))return i;r=s;let c;if(n.key&&n.debug?.()&&(c=Date.now()),i=t(...s),n.key&&n.debug?.()){let e=Math.round((Date.now()-o)*100)/100,t=Math.round((Date.now()-c)*100)/100,r=t/16,i=(e,t)=>{for(e=String(e);e.length<t;)e=` `+e;return e};console.info(`%câ± ${i(t,5)} /${i(e,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*r,120))}deg 100% 31%);`,n?.key)}return n?.onChange&&!(a&&n.skipInitialOnChange)&&n.onChange(i),a=!1,i}return o.updateDeps=e=>{r=e},o}function r(e,t){if(e===void 0)throw Error(`Unexpected undefined${t?`: ${t}`:``}`);return e}const i=(e,t)=>Math.abs(e-t)<1.01,a=(e,t,n)=>{let r;return function(...i){e.clearTimeout(r),r=e.setTimeout(()=>t.apply(this,i),n)}};var o=e=>{let{offsetWidth:t,offsetHeight:n}=e;return{width:t,height:n}};const s=e=>e,c=e=>{let t=Math.max(e.startIndex-e.overscan,0),n=Math.min(e.endIndex+e.overscan,e.count-1),r=[];for(let e=t;e<=n;e++)r.push(e);return r},l=(e,t)=>{let n=e.scrollElement;if(!n)return;let r=e.targetWindow;if(!r)return;let i=e=>{let{width:n,height:r}=e;t({width:Math.round(n),height:Math.round(r)})};if(i(o(n)),!r.ResizeObserver)return()=>{};let a=new r.ResizeObserver(t=>{let r=()=>{let e=t[0];if(e?.borderBoxSize){let t=e.borderBoxSize[0];if(t){i({width:t.inlineSize,height:t.blockSize});return}}i(o(n))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(r):r()});return a.observe(n,{box:`border-box`}),()=>{a.unobserve(n)}};var u={passive:!0},d=typeof window>`u`?!0:`onscrollend`in window;const f=(e,t)=>{let n=e.scrollElement;if(!n)return;let r=e.targetWindow;if(!r)return;let i=0,o=e.options.useScrollendEvent&&d?()=>void 0:a(r,()=>{t(i,!1)},e.options.isScrollingResetDelay),s=r=>()=>{let{horizontal:a,isRtl:s}=e.options;i=a?n.scrollLeft*(s&&-1||1):n.scrollTop,o(),t(i,r)},c=s(!0),l=s(!1);l(),n.addEventListener(`scroll`,c,u);let f=e.options.useScrollendEvent&&d;return f&&n.addEventListener(`scrollend`,l,u),()=>{n.removeEventListener(`scroll`,c),f&&n.removeEventListener(`scrollend`,l)}},p=(e,t,n)=>{if(t?.borderBoxSize){let e=t.borderBoxSize[0];if(e)return Math.round(e[n.options.horizontal?`inlineSize`:`blockSize`])}return e[n.options.horizontal?`offsetWidth`:`offsetHeight`]},m=(e,{adjustments:t=0,behavior:n},r)=>{let i=e+t;r.scrollElement?.scrollTo?.({[r.options.horizontal?`left`:`top`]:i,behavior:n})};var h=class{unsubs=[];options;scrollElement=null;targetWindow=null;isScrolling=!1;measurementsCache=[];itemSizeCache=new Map;laneAssignments=new Map;pendingMeasuredCacheIndexes=[];prevLanes=void 0;lanesChangedFlag=!1;lanesSettling=!1;scrollRect=null;scrollOffset=null;scrollDirection=null;scrollAdjustments=0;shouldAdjustScrollPositionOnItemSizeChange;elementsCache=new Map;observer=(()=>{let e=null,t=()=>e||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{let t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()})}));return{disconnect:()=>{t()?.disconnect(),e=null},observe:e=>t()?.observe(e,{box:`border-box`}),unobserve:e=>t()?.unobserve(e)}})();range=null;constructor(e){this.setOptions(e)}setOptions=e=>{Object.entries(e).forEach(([t,n])=>{n===void 0&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:s,rangeExtractor:c,onChange:()=>{},measureElement:p,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:`data-index`,initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}};notify=e=>{this.options.onChange?.(this,e)};maybeNotify=n(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]});cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null};_didMount=()=>()=>{this.cleanup()};_willUpdate=()=>{let e=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==e){if(this.cleanup(),!e){this.maybeNotify();return}this.scrollElement=e,this.scrollElement&&`ownerDocument`in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=this.scrollElement?.window??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?`forward`:`backward`:null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()}))}};getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?`width`:`height`]):(this.scrollRect=null,0);getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset==`function`?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0);getFurthestMeasurement=(e,t)=>{let n=new Map,r=new Map;for(let i=t-1;i>=0;i--){let t=e[i];if(n.has(t.lane))continue;let a=r.get(t.lane);if(a==null||t.end>a.end?r.set(t.lane,t):t.end<a.end&&n.set(t.lane,!0),n.size===this.options.lanes)break}return r.size===this.options.lanes?Array.from(r.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0};getMeasurementOptions=n(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(e,t,n,r,i,a)=>(this.prevLanes!==void 0&&this.prevLanes!==a&&(this.lanesChangedFlag=!0),this.prevLanes=a,this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:n,getItemKey:r,enabled:i,lanes:a}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}});getMeasurements=n(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:n,getItemKey:r,enabled:i,lanes:a},o)=>{if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>e)for(let t of this.laneAssignments.keys())t>=e&&this.laneAssignments.delete(t);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));let s=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===e&&(this.lanesSettling=!1);let c=this.measurementsCache.slice(0,s),l=Array(a).fill(void 0);for(let e=0;e<s;e++){let t=c[e];t&&(l[t.lane]=e)}for(let i=s;i<e;i++){let e=r(i),a=this.laneAssignments.get(i),s,u;if(a!==void 0&&this.options.lanes>1){s=a;let e=l[s],r=e===void 0?void 0:c[e];u=r?r.end+this.options.gap:t+n}else{let e=this.options.lanes===1?c[i-1]:this.getFurthestMeasurement(c,i);u=e?e.end+this.options.gap:t+n,s=e?e.lane:i%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(i,s)}let d=o.get(e),f=typeof d==`number`?d:this.options.estimateSize(i),p=u+f;c[i]={index:i,start:u,size:f,end:p,key:e,lane:s},l[s]=i}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug});calculateRange=n(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,t,n,r)=>this.range=e.length>0&&t>0?_({measurements:e,outerSize:t,scrollOffset:n,lanes:r}):null,{key:!1,debug:()=>this.options.debug});getVirtualIndexes=n(()=>{let e=null,t=null,n=this.calculateRange();return n&&(e=n.startIndex,t=n.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]},(e,t,n,r,i)=>r===null||i===null?[]:e({startIndex:r,endIndex:i,overscan:t,count:n}),{key:!1,debug:()=>this.options.debug});indexFromElement=e=>{let t=this.options.indexAttribute,n=e.getAttribute(t);return n?parseInt(n,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)};_measureElement=(e,t)=>{let n=this.indexFromElement(e),r=this.measurementsCache[n];if(!r)return;let i=r.key,a=this.elementsCache.get(i);a!==e&&(a&&this.observer.unobserve(a),this.observer.observe(e),this.elementsCache.set(i,e)),e.isConnected&&this.resizeItem(n,this.options.measureElement(e,t,this))};resizeItem=(e,t)=>{let n=this.measurementsCache[e];if(!n)return;let r=t-(this.itemSizeCache.get(n.key)??n.size);r!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange===void 0?n.start<this.getScrollOffset()+this.scrollAdjustments:this.shouldAdjustScrollPositionOnItemSizeChange(n,r,this))&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=r,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,t)),this.notify(!1))};measureElement=e=>{if(!e){this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))});return}this._measureElement(e,void 0)};getVirtualItems=n(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,t)=>{let n=[];for(let r=0,i=e.length;r<i;r++){let i=t[e[r]];n.push(i)}return n},{key:!1,debug:()=>this.options.debug});getVirtualItemForOffset=e=>{let t=this.getMeasurements();if(t.length!==0)return r(t[g(0,t.length-1,e=>r(t[e]).start,e)])};getOffsetForAlignment=(e,t,n=0)=>{let r=this.getSize(),i=this.getScrollOffset();t===`auto`&&(t=e>=i+r?`end`:`start`),t===`center`?e+=(n-r)/2:t===`end`&&(e-=r);let a=this.getTotalSize()+this.options.scrollMargin-r;return Math.max(Math.min(a,e),0)};getOffsetForIndex=(e,t=`auto`)=>{e=Math.max(0,Math.min(e,this.options.count-1));let n=this.measurementsCache[e];if(!n)return;let r=this.getSize(),i=this.getScrollOffset();if(t===`auto`)if(n.end>=i+r-this.options.scrollPaddingEnd)t=`end`;else if(n.start<=i+this.options.scrollPaddingStart)t=`start`;else return[i,t];let a=t===`end`?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,t,n.size),t]};isDynamicMode=()=>this.elementsCache.size>0;scrollToOffset=(e,{align:t=`start`,behavior:n}={})=>{n===`smooth`&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:n})};scrollToIndex=(e,{align:t=`auto`,behavior:n}={})=>{n===`smooth`&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let r=0,a=t=>{if(!this.targetWindow)return;let r=this.getOffsetForIndex(e,t);if(!r){console.warn(`Failed to get offset for index:`,e);return}let[a,s]=r;this._scrollToOffset(a,{adjustments:void 0,behavior:n}),this.targetWindow.requestAnimationFrame(()=>{let t=this.getScrollOffset(),n=this.getOffsetForIndex(e,s);if(!n){console.warn(`Failed to get offset for index:`,e);return}i(n[0],t)||o(s)})},o=t=>{this.targetWindow&&(r++,r<10?this.targetWindow.requestAnimationFrame(()=>a(t)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};a(t)};scrollBy=(e,{behavior:t}={})=>{t===`smooth`&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})};getTotalSize=()=>{let e=this.getMeasurements(),t;if(e.length===0)t=this.options.paddingStart;else if(this.options.lanes===1)t=e[e.length-1]?.end??0;else{let n=Array(this.options.lanes).fill(null),r=e.length-1;for(;r>=0&&n.some(e=>e===null);){let t=e[r];n[t.lane]===null&&(n[t.lane]=t.end),r--}t=Math.max(...n.filter(e=>e!==null))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)};_scrollToOffset=(e,{adjustments:t,behavior:n})=>{this.options.scrollToFn(e,{behavior:n,adjustments:t},this)};measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)}},g=(e,t,n,r)=>{for(;e<=t;){let i=(e+t)/2|0,a=n(i);if(a<r)e=i+1;else if(a>r)t=i-1;else return i}return e>0?e-1:0};function _({measurements:e,outerSize:t,scrollOffset:n,lanes:r}){let i=e.length-1,a=t=>e[t].start;if(e.length<=r)return{startIndex:0,endIndex:i};let o=g(0,i,a,n),s=o;if(r===1)for(;s<i&&e[s].end<n+t;)s++;else if(r>1){let a=Array(r).fill(0);for(;s<i&&a.some(e=>e<n+t);){let t=e[s];a[t.lane]=t.end,s++}let c=Array(r).fill(n+t);for(;o>=0&&c.some(e=>e>=n);){let t=e[o];c[t.lane]=t.start,o--}o=Math.max(0,o-o%r),s=Math.min(i,s+(r-1-s%r))}return{startIndex:o,endIndex:s}}var v=class extends e.Data.TaggedError(`ChangeTrackerError`){},y=class extends e.Data.TaggedError(`ValidationError`){},b=class extends e.Data.TaggedError(`CellEditorError`){},x=class extends e.Data.TaggedError(`VimCommandTrackerError`){},S=class extends e.Data.TaggedError(`CommandLineError`){};const C=t.z.string().min(1,`Row ID must not be empty`),w=t.z.string().refine(e=>e===`key`||e===`context`||e.startsWith(`values.`),{message:`Field must be 'key', 'context', or start with 'values.'`}),T=t.z.string().min(1,`Language code must not be empty`),ee=t.z.string().regex(/^.+-.+$/,`Change key must be in format 'rowId-field'`);function E(n,r,i){return e.Effect.try({try:()=>n.parse(r),catch:e=>e instanceof t.z.ZodError?new y({message:i||`Validation failed`,issues:e.issues.map(e=>({path:e.path.map(String),message:e.message}))}):new y({message:i||`Validation failed`,issues:[{path:[],message:String(e)}]})})}const te={enableValidation:!1},D={DEBUG:0,INFO:1,WARN:2,ERROR:3};var ne=class{level;constructor(){this.level=D.WARN}setLevel(e){this.level=e}getLevel(){return this.level}debug(...e){this.level<=D.DEBUG&&console.log(`[DEBUG]`,...e)}info(...e){this.level<=D.INFO&&console.log(`[INFO]`,...e)}warn(...e){this.level<=D.WARN&&console.warn(`[WARN]`,...e)}error(...e){this.level<=D.ERROR&&console.error(`[ERROR]`,...e)}};const O=new ne;var k=class{config;changes=new Map;originalData=new Map;constructor(e=te){this.config={...te,...e}}initializeOriginalData(t,n){if(this.config.enableValidation){for(let t of n){let n=E(T,t,`Invalid language code: ${t}`);e.Effect.runSync(e.Effect.match(n,{onFailure:e=>{throw O.error(`ChangeTracker: Invalid language code`,e),e},onSuccess:()=>{}}))}for(let n of t){let t=E(C,n.id,`Invalid row ID: ${n.id}`);if(e.Effect.runSync(e.Effect.match(t,{onFailure:e=>{throw O.error(`ChangeTracker: Invalid row ID`,e),e},onSuccess:()=>{}})),typeof n.key!=`string`||n.key.length===0){let t=new v({message:`Invalid key for translation ${n.id}`,code:`INVALID_CHANGE_DATA`});e.Effect.runSync(e.Effect.match(e.Effect.fail(t),{onFailure:e=>{throw O.error(`ChangeTracker: Invalid translation key`,e),e},onSuccess:()=>{}}))}}}this.originalData.clear(),this.changes.clear(),t.forEach(e=>{let t=new Map;t.set(`key`,e.key),t.set(`context`,e.context||``),n.forEach(n=>{t.set(`values.${n}`,e.values[n]||``)}),this.originalData.set(e.id,t)})}getOriginalValueEffect(t,n){return e.Effect.flatMap(E(C,t,`Invalid row ID`),t=>e.Effect.flatMap(E(w,n,`Invalid field`),n=>{let r=this.originalData.get(t);if(!r)return e.Effect.fail(new v({message:`Original data not found for row ID: ${t}`,code:`ORIGINAL_DATA_NOT_FOUND`}));let i=r.get(n);return e.Effect.succeed(e.Option.fromNullable(i))}))}getOriginalValue(t,n){if(!this.config.enableValidation)return this.originalData.get(t)?.get(n)??``;let r=this.getOriginalValueEffect(t,n);return e.Effect.runSync(e.Effect.match(r,{onFailure:()=>``,onSuccess:t=>e.Option.getOrElse(t,()=>``)}))}trackChangeEffect(t,n,r,i,a,o){return e.Effect.flatMap(E(C,t,`Invalid row ID`),t=>e.Effect.flatMap(E(w,n,`Invalid field`),n=>e.Effect.flatMap(E(T,r,`Invalid language code`),r=>{if(typeof o!=`string`||o.length===0)return e.Effect.fail(new v({message:`Key must be a non-empty string`,code:`INVALID_CHANGE_DATA`}));let s=`${t}-${n}`;if(i===a)return this.changes.delete(s),e.Effect.void;let c={id:t,key:o,lang:r,oldValue:i,newValue:a};return this.changes.set(s,c),e.Effect.void})))}trackChange(t,n,r,i,a,o,s){if(!this.config.enableValidation){let e=`${t}-${n}`;if(i===a){this.changes.delete(e),s&&s(t,n,!1);return}let c={id:t,key:o,lang:r,oldValue:i,newValue:a};this.changes.set(e,c),s&&s(t,n,!0);return}let c=this.trackChangeEffect(t,n,r,i,a,o);e.Effect.runSync(e.Effect.match(c,{onFailure:e=>{O.warn(`ChangeTracker: Failed to track change`,e)},onSuccess:()=>{s&&s(t,n,i!==a)}}))}hasChangeEffect(t,n){return e.Effect.flatMap(E(C,t,`Invalid row ID`),t=>e.Effect.flatMap(E(w,n,`Invalid field`),n=>{let r=`${t}-${n}`;return e.Effect.succeed(this.changes.has(r))}))}hasChange(t,n){if(!this.config.enableValidation){let e=`${t}-${n}`;return this.changes.has(e)}let r=this.hasChangeEffect(t,n);return e.Effect.runSync(e.Effect.match(r,{onFailure:()=>!1,onSuccess:e=>e}))}getChanges(){return Array.from(this.changes.values())}clearChanges(e){e&&this.changes.forEach((t,n)=>{let[r,i]=n.split(`-`,2);e(r,i,!1)}),this.changes.clear()}getChangesMap(){return this.changes}},re=class{history=[];currentIndex=-1;maxHistorySize=100;push(e){this.history=this.history.slice(0,this.currentIndex+1),this.history.push(e),this.currentIndex++,this.history.length>this.maxHistorySize&&(this.history.shift(),this.currentIndex--)}canUndo(){return this.currentIndex>=0}canRedo(){return this.currentIndex<this.history.length-1}undo(){if(!this.canUndo())return null;let e=this.history[this.currentIndex];return this.currentIndex--,{type:e.type,rowId:e.rowId,columnId:e.columnId,oldValue:e.newValue,newValue:e.oldValue}}redo(){return this.canRedo()?(this.currentIndex++,this.history[this.currentIndex]):null}clear(){this.history=[],this.currentIndex=-1}getHistoryState(){return{length:this.history.length,currentIndex:this.currentIndex,canUndo:this.canUndo(),canRedo:this.canRedo()}}},ie=class{metaKeyPressed=!1;ctrlKeyPressed=!1;modifierKeyDownHandler=null;modifierKeyUpHandler=null;attach(){this.modifierKeyDownHandler||this.modifierKeyUpHandler||(this.modifierKeyDownHandler=e=>{(e.key===`Meta`||e.key===`MetaLeft`||e.key===`MetaRight`)&&(this.metaKeyPressed=!0),(e.key===`Control`||e.key===`ControlLeft`||e.key===`ControlRight`)&&(this.ctrlKeyPressed=!0)},this.modifierKeyUpHandler=e=>{(e.key===`Meta`||e.key===`MetaLeft`||e.key===`MetaRight`)&&(this.metaKeyPressed=!1),(e.key===`Control`||e.key===`ControlLeft`||e.key===`ControlRight`)&&(this.ctrlKeyPressed=!1)},window.addEventListener(`keydown`,this.modifierKeyDownHandler,!0),window.addEventListener(`keyup`,this.modifierKeyUpHandler,!0))}detach(){this.modifierKeyDownHandler&&=(window.removeEventListener(`keydown`,this.modifierKeyDownHandler,!0),null),this.modifierKeyUpHandler&&=(window.removeEventListener(`keyup`,this.modifierKeyUpHandler,!0),null)}isModifierPressed(e){return navigator.platform.toUpperCase().indexOf(`MAC`)>=0?this.metaKeyPressed||e.metaKey||this.ctrlKeyPressed||e.ctrlKey:this.ctrlKeyPressed||e.ctrlKey||this.metaKeyPressed||e.metaKey}get metaKey(){return this.metaKeyPressed}get ctrlKey(){return this.ctrlKeyPressed}reset(){this.metaKeyPressed=!1,this.ctrlKeyPressed=!1}},ae=class{focusedCell=null;getFocusedCell(){return this.focusedCell}focusCell(e,t){this.focusedCell={rowIndex:e,columnId:t}}blur(){this.focusedCell=null}hasFocus(){return this.focusedCell!==null}};function A(e){return{id:e.id,key:e.key,context:e.context,values:{...e.values},createdAt:e.createdAt,updatedAt:e.updatedAt,updatedBy:e.updatedBy}}function oe(e){return e===`key`?`key`:e===`context`?`context`:e.startsWith(`values.`)?e.replace(`values.`,``):e}function se(e,t,n,r){return n===`key`?r:e.find(e=>e.id===t)?.key||``}function ce(e,t,n){return e.some(e=>e.id!==t&&e.key.trim()===n.trim())}var le=class{editingCell=null;isEscapeKeyPressed=!1;isFinishingEdit=!1;translations;changeTracker;undoRedoManager;callbacks;constructor(e,t,n,r={}){this.translations=e,this.changeTracker=t,this.undoRedoManager=n,this.callbacks=r}getEditingCell(){return this.editingCell}isEditing(){return this.editingCell!==null}startEditingEffect(t,n,r,i){this.editingCell&&this.stopEditing();let a=i.querySelector(`.virtual-grid-cell-content`);if(!a)return e.Effect.fail(new b({message:`Cell content not found`,code:`TRANSLATION_NOT_FOUND`}));let o=a.textContent||``,s=this.createEditInput(o);i.innerHTML=``,i.appendChild(s),requestAnimationFrame(()=>{s.focus(),s.select()}),this.editingCell={rowIndex:t,columnId:n,rowId:r},this.callbacks.onEditStateChange&&this.callbacks.onEditStateChange(!0);let c=!1;if(n===`key`){let e=()=>{let e=s.value.trim();c=!1,i.classList.remove(`cell-duplicate-key`),e&&ce(this.translations,r,e)&&(c=!0,i.classList.add(`cell-duplicate-key`))};s.addEventListener(`input`,e),e()}return this.attachInputListeners(s,i,e=>{if(this.isFinishingEdit)return;this.isFinishingEdit=!0,e&&n===`key`&&c&&(e=!1),e&&s.value!==o&&this.applyCellChange(r,n,o,s.value).catch(e=>{O.error(`Failed to apply cell change:`,e)});let t=e?s.value:o;this.callbacks.updateCellContent&&this.callbacks.updateCellContent(i,r,n,t),this.editingCell=null,this.isFinishingEdit=!1,this.callbacks.onEditStateChange&&this.callbacks.onEditStateChange(!1)},t,n,o,r),e.Effect.void}startEditing(e,t,n,r){this.editingCell&&this.stopEditing();let i=r.querySelector(`.virtual-grid-cell-content`);if(!i)return;let a=i.textContent||``,o=this.createEditInput(a);r.innerHTML=``,r.appendChild(o),requestAnimationFrame(()=>{o.focus(),o.select()}),this.editingCell={rowIndex:e,columnId:t,rowId:n},this.callbacks.onEditStateChange&&this.callbacks.onEditStateChange(!0);let s=!1;if(t===`key`){let e=()=>{let e=o.value.trim();s=!1,r.classList.remove(`cell-duplicate-key`),e&&ce(this.translations,n,e)&&(s=!0,r.classList.add(`cell-duplicate-key`))};o.addEventListener(`input`,e),e()}this.attachInputListeners(o,r,e=>{if(this.isFinishingEdit)return;this.isFinishingEdit=!0,e&&t===`key`&&s&&(e=!1),e&&o.value!==a&&this.applyCellChange(n,t,a,o.value).catch(e=>{O.error(`Failed to apply cell change:`,e)});let i=e?o.value:a;this.callbacks.updateCellContent&&this.callbacks.updateCellContent(r,n,t,i),this.editingCell=null,this.isFinishingEdit=!1,this.callbacks.onEditStateChange&&this.callbacks.onEditStateChange(!1)},e,t,a,n)}attachInputListeners(e,t,n,r,i,a,o){e.addEventListener(`blur`,()=>{this.isFinishingEdit||(this.isEscapeKeyPressed?(n(!1),this.isEscapeKeyPressed=!1):n(!0))}),e.addEventListener(`beforeinput`,e=>{(e.inputType===`historyUndo`||e.inputType===`historyRedo`)&&(e.preventDefault(),n(!0))}),e.addEventListener(`keydown`,t=>{if(t.key===`Enter`){t.preventDefault(),t.stopPropagation();let a=t.shiftKey?`up`:`down`;n(!0),e.blur(),i.startsWith(`values.`)&&this.callbacks.onEditFinished&&requestAnimationFrame(()=>{this.callbacks.onEditFinished&&this.callbacks.onEditFinished(r,i,a)})}else t.key===`Escape`?(t.preventDefault(),t.stopPropagation(),this.isEscapeKeyPressed=!0,e.blur()):t.key===`Tab`&&(t.preventDefault(),t.stopPropagation(),n(!0),e.blur())})}applyCellChangeEffect(t,n,r,i){let a=this.translations.find(e=>e.id===t);if(!a)return e.Effect.fail(new b({message:`Translation not found: ${t}`,code:`TRANSLATION_NOT_FOUND`}));let o=A(a);if(n===`key`)o.key=i;else if(n===`context`)o.context=i;else if(n.startsWith(`values.`)){let e=n.replace(`values.`,``);o.values[e]=i}else return e.Effect.fail(new b({message:`Invalid column ID: ${n}`,code:`INVALID_COLUMN_ID`}));this.undoRedoManager.push({type:`cell-change`,rowId:t,columnId:n,oldValue:r,newValue:i});let s=this.changeTracker.getOriginalValue(t,n),c=oe(n),l=se(this.translations,t,n,i);return this.changeTracker.trackChange(t,n,c,s,i,l,()=>{this.callbacks.updateCellStyle&&this.callbacks.updateCellStyle(t,n)}),this.callbacks.onCellChange&&this.callbacks.onCellChange(t,n,i),e.Effect.void}async applyCellChange(t,n,r,i){let a=this.applyCellChangeEffect(t,n,r,i);return e.Effect.runPromise(a)}stopEditingEffect(t){return this.editingCell&&this.stopEditing(t),e.Effect.void}stopEditing(e){if(!this.editingCell||!e){this.editingCell=null;return}let t=e.querySelector(`[data-row-index="${this.editingCell.rowIndex}"]`);if(t){let e=t.querySelector(`[data-column-id="${this.editingCell.columnId}"]`);if(e){let t=e.querySelector(`input`);if(t){let n=e.getAttribute(`data-row-id`),r=this.editingCell.columnId,i=t.value;this.isFinishingEdit=!0,this.callbacks.updateCellContent&&n&&this.callbacks.updateCellContent(e,n,r,i),this.isFinishingEdit=!1}}}this.editingCell=null}createEditInput(e){let t=document.createElement(`input`);return t.type=`text`,t.value=e,t.className=`virtual-grid-cell-input`,t.style.width=`100%`,t.style.height=`100%`,t.style.border=`2px solid #3b82f6`,t.style.outline=`none`,t.style.padding=`4px 8px`,t.style.fontSize=`14px`,t.style.fontFamily=`inherit`,t.style.backgroundColor=`#fff`,t}setEscapeKeyPressed(e){this.isEscapeKeyPressed=e}},ue=class{keyboardHandler=null;modifierKeyTracker;focusManager;callbacks;constructor(e,t,n={}){this.modifierKeyTracker=e,this.focusManager=t,this.callbacks=n}attach(){this.keyboardHandler||(this.keyboardHandler=e=>{let t=this.modifierKeyTracker.isModifierPressed(e),n=e.target,r=n.tagName===`INPUT`||n.tagName===`TEXTAREA`||n.isContentEditable,i=(e.key===`z`||e.key===`Z`||e.code===`KeyZ`)&&!e.shiftKey;if(t&&i){e.preventDefault(),e.stopPropagation(),this.callbacks.onUndo&&this.callbacks.onUndo();return}let a=e.key===`y`||e.key===`Y`||e.code===`KeyY`||(e.key===`z`||e.key===`Z`||e.code===`KeyZ`)&&e.shiftKey;if(t&&a){e.preventDefault(),e.stopPropagation(),this.callbacks.onRedo&&this.callbacks.onRedo();return}if(t&&(e.key===`k`||e.code===`KeyK`)){e.preventDefault(),e.stopPropagation(),this.callbacks.onOpenCommandPalette&&this.callbacks.onOpenCommandPalette(`excel`);return}if(t&&(e.key===`f`||e.code===`KeyF`)&&!r){e.preventDefault(),e.stopPropagation(),this.callbacks.onOpenFind&&this.callbacks.onOpenFind();return}if(t&&(e.key===`h`||e.code===`KeyH`)&&!r){e.preventDefault(),e.stopPropagation(),this.callbacks.onOpenReplace&&this.callbacks.onOpenReplace();return}if((e.key===`/`||e.code===`Slash`)&&!r&&(!this.callbacks.isQuickSearchMode||!this.callbacks.isQuickSearchMode())){e.preventDefault(),e.stopPropagation(),this.callbacks.onOpenQuickSearch&&this.callbacks.onOpenQuickSearch();return}if(this.callbacks.isQuickSearchMode&&this.callbacks.isQuickSearchMode()&&!r){if(e.key===`n`&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),this.callbacks.onQuickSearchNext&&this.callbacks.onQuickSearchNext();return}if(e.key===`N`||e.key===`n`&&e.shiftKey){e.preventDefault(),e.stopPropagation(),this.callbacks.onQuickSearchPrev&&this.callbacks.onQuickSearchPrev();return}}if(e.key===`F2`||e.code===`F2`){if(this.focusManager.hasFocus()&&!r){e.preventDefault(),e.stopPropagation();let t=this.focusManager.getFocusedCell();if(t&&this.callbacks.onStartEditing){if(this.callbacks.isEditableColumn&&!this.callbacks.isEditableColumn(t.columnId)||this.callbacks.isReadOnly&&this.callbacks.isReadOnly())return;this.callbacks.onStartEditing(t.rowIndex,t.columnId)}}return}if(e.key===`Enter`&&this.focusManager.hasFocus()&&!r&&(!this.callbacks.isQuickSearchMode||!this.callbacks.isQuickSearchMode())){let t=this.focusManager.getFocusedCell();if(t){let n=t.columnId.startsWith(`values.`);if(e.shiftKey){if(!n)return}else if(!n){if(this.callbacks.isEditableColumn&&!this.callbacks.isEditableColumn(t.columnId)||this.callbacks.isReadOnly&&this.callbacks.isReadOnly())return;if(this.callbacks.onStartEditing){e.preventDefault(),e.stopPropagation(),this.callbacks.onStartEditing(t.rowIndex,t.columnId);return}}}}this.focusManager.hasFocus()&&!r&&this.handleKeyboardNavigation(e)},document.addEventListener(`keydown`,this.keyboardHandler,!0))}detach(){this.keyboardHandler&&=(document.removeEventListener(`keydown`,this.keyboardHandler,!0),null)}handleKeyboardNavigation(e){let t=this.focusManager.getFocusedCell();if(!t||!this.callbacks.getAllColumns||!this.callbacks.focusCell)return;let{rowIndex:n,columnId:r}=t,i=this.callbacks.getAllColumns(),a=this.callbacks.getMaxRowIndex?this.callbacks.getMaxRowIndex():1/0,o=i.indexOf(r);if(o<0)return;let s=n,c=o;if(e.key===`Tab`&&(e.preventDefault(),e.stopPropagation(),e.shiftKey?o>0?c=o-1:n>0?(s=n-1,c=i.length-1):(s=a,c=i.length-1):o<i.length-1?c=o+1:n<a?(s=n+1,c=0):(s=0,c=0)),e.key===`Enter`&&r.startsWith(`values.`))if(e.preventDefault(),e.stopPropagation(),e.shiftKey)if(n>0)s=n-1;else return;else if(n<a)s=n+1;else return;e.key.startsWith(`Arrow`)&&(e.preventDefault(),e.stopPropagation(),e.key===`ArrowRight`&&o<i.length-1?c=o+1:e.key===`ArrowLeft`&&o>0?c=o-1:e.key===`ArrowDown`&&n<a?s=n+1:e.key===`ArrowUp`&&n>0&&(s=n-1));let l=i[c];l&&(this.focusManager.focusCell(s,l),this.callbacks.focusCell(s,l),this.callbacks.onNavigate&&this.callbacks.onNavigate(s,l))}updateCallbacks(e){this.callbacks={...this.callbacks,...e}}},de=class{isResizing=!1;resizeStartX=0;resizeStartWidth=0;resizeColumnId=null;resizeHandler=null;resizeEndHandler=null;options;constructor(e){this.options=e}addResizeHandle(e,t){let n=document.createElement(`div`);n.className=`column-resize-handle`,n.setAttribute(`data-column-id`,t),n.style.position=`absolute`,n.style.right=`-2px`,n.style.top=`0`,n.style.bottom=`0`,n.style.width=`4px`,n.style.cursor=`col-resize`,n.style.zIndex=`25`,n.style.backgroundColor=`transparent`,n.addEventListener(`mousedown`,n=>{n.preventDefault(),n.stopPropagation(),this.startResize(t,n.clientX,e)}),e.appendChild(n)}startResize(e,t,n){this.isResizing=!0,this.resizeStartX=t,this.resizeStartWidth=n.offsetWidth||n.getBoundingClientRect().width,this.resizeColumnId=e,this.options.callbacks.onResizeStart&&this.options.callbacks.onResizeStart(e),this.resizeHandler=e=>{!this.isResizing||!this.resizeColumnId||(e.preventDefault(),this.handleResize(e.clientX))},this.resizeEndHandler=e=>{this.isResizing&&(e.preventDefault(),this.endResize())},document.addEventListener(`mousemove`,this.resizeHandler,!0),document.addEventListener(`mouseup`,this.resizeEndHandler,!0),document.body.style.cursor=`col-resize`,document.body.style.userSelect=`none`}handleResize(e){if(!this.resizeColumnId)return;let t=e-this.resizeStartX,n=this.options.columnMinWidths.get(this.resizeColumnId)||80,r=Math.max(n,this.resizeStartWidth+t),i=`values.${this.options.languages[this.options.languages.length-1]}`;this.resizeColumnId!==i&&this.options.columnWidths.set(this.resizeColumnId,r),this.options.callbacks.onResize&&this.options.callbacks.onResize(this.resizeColumnId,r)}endResize(){this.resizeHandler&&=(document.removeEventListener(`mousemove`,this.resizeHandler,!0),null),this.resizeEndHandler&&=(document.removeEventListener(`mouseup`,this.resizeEndHandler,!0),null),document.body.style.cursor=``,document.body.style.userSelect=``;let e=this.resizeColumnId,t=e&&this.options.columnWidths.get(e)||this.resizeStartWidth;this.isResizing=!1,this.resizeColumnId=null,e&&this.options.callbacks.onResizeEnd&&this.options.callbacks.onResizeEnd(e,t)}isResizingActive(){return this.isResizing}reset(){this.isResizing&&this.endResize()}},fe=class{defaultKeyWidth;defaultContextWidth;defaultLangWidth;options;constructor(e){this.options=e,this.defaultKeyWidth=e.defaultKeyWidth??200,this.defaultContextWidth=e.defaultContextWidth??200,this.defaultLangWidth=e.defaultLangWidth??150}getColumnWidthValue(e,t){return this.options.columnWidths.get(e)||t||this.getDefaultWidth(e)}getDefaultWidth(e){return e===`row-number`?50:e===`key`?this.defaultKeyWidth:e===`context`?this.defaultContextWidth:this.defaultLangWidth}calculateColumnWidths(e){let t=this.getColumnWidthValue(`row-number`,50),n=this.getColumnWidthValue(`key`,this.defaultKeyWidth),r=this.getColumnWidthValue(`context`,this.defaultContextWidth),i=this.options.languages.map(e=>this.getColumnWidthValue(`values.${e}`,this.defaultLangWidth)),a=t+n+r+i.slice(0,-1).reduce((e,t)=>e+t,0),o=this.options.languages[this.options.languages.length-1],s=this.options.columnMinWidths.get(`values.${o}`)||80,c=Math.max(s,e-a);return{rowNumber:t,key:n,context:r,languages:[...i.slice(0,-1),c]}}applyColumnWidth(e,t,n){let r=`values.${this.options.languages[this.options.languages.length-1]}`;e!==r&&this.options.columnWidths.set(e,t);let i=this.getColumnWidthValue(`row-number`,50),a=e===`key`?t:this.getColumnWidthValue(`key`,this.defaultKeyWidth),o=e===`context`?t:this.getColumnWidthValue(`context`,this.defaultContextWidth),s=this.options.languages.slice(0,-1).map(n=>{let r=`values.${n}`;return e===r?t:this.getColumnWidthValue(r,this.defaultLangWidth)}),c=i+a+o+s.reduce((e,t)=>e+t,0),l=this.options.columnMinWidths.get(r)||80,u=Math.max(l,n-c);return{columnWidths:{rowNumber:i,key:a,context:o,languages:[...s,u]},totalWidth:n}}},pe=class{options;constructor(e){this.options=e}createHeaderCell(e,t,n,r,i){let a=document.createElement(`div`);return a.className=`virtual-grid-header-cell`,a.setAttribute(`role`,`columnheader`),a.textContent=e,i&&a.setAttribute(`data-column-id`,i),a.style.width=`${t}px`,a.style.minWidth=`${t}px`,a.style.maxWidth=`${t}px`,(n>0||r>0)&&(a.style.position=`sticky`,a.style.left=`${n}px`,a.style.zIndex=r.toString(),a.style.backgroundColor=`#f8fafc`),a.style.overflow=`visible`,a}createRow(e,t,n){let r=document.createElement(`div`);r.className=`virtual-grid-row`,r.setAttribute(`role`,`row`),r.setAttribute(`data-row-index`,t.toString()),r.setAttribute(`data-row-id`,e.id);let i=this.createCell(e.id,`row-number`,(t+1).toString(),t,!1,n.rowNumber,0,15);i.classList.add(`row-number-cell`),r.appendChild(i);let a=this.createCell(e.id,`key`,e.key,t,!this.options.readOnly,n.key,n.rowNumber,10);r.appendChild(a);let o=this.createCell(e.id,`context`,e.context||``,t,!this.options.readOnly,n.context,n.rowNumber+n.key,10);return r.appendChild(o),this.options.languages.forEach((i,a)=>{let o=e.values[i]||``,s=n.languages[a],c=n.rowNumber+n.key+n.context,l=this.createCell(e.id,`values.${i}`,o,t,!this.options.readOnly,s,c,0);r.appendChild(l)}),r}createCell(e,t,n,r,i,a,o,s){let c=document.createElement(`div`);c.className=`virtual-grid-cell`,c.setAttribute(`role`,`gridcell`),c.setAttribute(`data-row-id`,e),c.setAttribute(`data-column-id`,t),c.setAttribute(`data-row-index`,r.toString()),c.setAttribute(`tabindex`,i?`0`:`-1`),c.style.width=`${a}px`,c.style.minWidth=`${a}px`,c.style.maxWidth=`${a}px`,(o>0||s>0)&&(c.style.position=`sticky`,c.style.left=`${o}px`,c.style.zIndex=s.toString(),c.style.backgroundColor=`#fafafa`);let l=document.createElement(`div`);return l.className=`virtual-grid-cell-content`,l.textContent=n,c.appendChild(l),this.options.callbacks.updateCellStyle&&this.options.callbacks.updateCellStyle(e,t,c),i&&!this.options.readOnly&&(c.addEventListener(`dblclick`,e=>{e.preventDefault(),e.stopPropagation(),this.options.callbacks.onCellDblClick&&this.options.callbacks.onCellDblClick(r,t,c)}),c.addEventListener(`focus`,()=>{this.options.callbacks.onCellFocus&&this.options.callbacks.onCellFocus(r,t),c.classList.add(`focused`)}),c.addEventListener(`blur`,()=>{c.classList.remove(`focused`)})),c}updateCellContent(e,t,n,r,i){e.innerHTML=``;let a=document.createElement(`div`);a.className=`virtual-grid-cell-content`,a.textContent=r,e.appendChild(a),!this.options.readOnly&&this.options.editableColumns.has(n)&&e.addEventListener(`dblclick`,t=>{t.preventDefault(),t.stopPropagation(),this.options.callbacks.onCellDblClick&&this.options.callbacks.onCellDblClick(i,n,e)}),this.options.callbacks.updateCellStyle&&this.options.callbacks.updateCellStyle(t,n,e)}},me=class{commands=new Map;usageCounts=new Map;storageKey=`command-palette-usage`;callbacks;constructor(e={}){this.callbacks=e,this.loadUsageCounts()}registerCommand(e){let t={...e,usageCount:e.usageCount??0,availableInModes:e.availableInModes??[`all`]};this.commands.set(e.id,t),this.applySavedUsageCount(e.id)}getCommandById(e){return this.commands.get(e)}getCommands(e){let t=Array.from(this.commands.values());return!e||e===`all`?t:t.filter(t=>{let n=t.availableInModes??[`all`];return n.includes(`all`)||n.includes(e)})}incrementUsage(e){let t=(this.usageCounts.get(e)??0)+1;this.usageCounts.set(e,t);let n=this.commands.get(e);n&&(n.usageCount=t),this.saveUsageCounts(),this.callbacks.onCommandExecuted&&this.callbacks.onCommandExecuted(e)}getPopularCommands(e=10,t){return this.getCommands(t).sort((e,t)=>{let n=this.usageCounts.get(e.id)??0;return(this.usageCounts.get(t.id)??0)-n}).slice(0,e)}loadUsageCounts(){try{let e=localStorage.getItem(this.storageKey);if(e){let t=JSON.parse(e);this.usageCounts=new Map(Object.entries(t))}}catch(e){O.warn(`Failed to load command usage counts:`,e)}}applySavedUsageCount(e){let t=this.usageCounts.get(e);if(t!==void 0){let n=this.commands.get(e);n&&(n.usageCount=t)}}saveUsageCounts(){try{let e=Object.fromEntries(this.usageCounts);localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){O.warn(`Failed to save command usage counts:`,e)}}clear(){this.commands.clear(),this.usageCounts.clear(),localStorage.removeItem(this.storageKey)}};function j(e){return Array.isArray?Array.isArray(e):be(e)===`[object Array]`}var he=1/0;function ge(e){if(typeof e==`string`)return e;let t=e+``;return t==`0`&&1/e==-he?`-0`:t}function _e(e){return e==null?``:ge(e)}function M(e){return typeof e==`string`}function N(e){return typeof e==`number`}function ve(e){return e===!0||e===!1||ye(e)&&be(e)==`[object Boolean]`}function P(e){return typeof e==`object`}function ye(e){return P(e)&&e!==null}function F(e){return e!=null}function I(e){return!e.trim().length}function be(e){return e==null?e===void 0?`[object Undefined]`:`[object Null]`:Object.prototype.toString.call(e)}var xe=`Incorrect 'index' type`,Se=e=>`Invalid value for key ${e}`,Ce=e=>`Pattern length exceeds max of ${e}.`,we=e=>`Missing ${e} property in key`,Te=e=>`Property 'weight' in key '${e}' must be a positive integer`,Ee=Object.prototype.hasOwnProperty,De=class{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(e=>{let n=Oe(e);this._keys.push(n),this._keyMap[n.id]=n,t+=n.weight}),this._keys.forEach(e=>{e.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function Oe(e){let t=null,n=null,r=null,i=1,a=null;if(M(e)||j(e))r=e,t=ke(e),n=L(e);else{if(!Ee.call(e,`name`))throw Error(we(`name`));let o=e.name;if(r=o,Ee.call(e,`weight`)&&(i=e.weight,i<=0))throw Error(Te(o));t=ke(o),n=L(o),a=e.getFn}return{path:t,id:n,weight:i,src:r,getFn:a}}function ke(e){return j(e)?e:e.split(`.`)}function L(e){return j(e)?e.join(`.`):e}function Ae(e,t){let n=[],r=!1,i=(e,t,a)=>{if(F(e))if(!t[a])n.push(e);else{let o=e[t[a]];if(!F(o))return;if(a===t.length-1&&(M(o)||N(o)||ve(o)))n.push(_e(o));else if(j(o)){r=!0;for(let e=0,n=o.length;e<n;e+=1)i(o[e],t,a+1)}else t.length&&i(o,t,a+1)}};return i(e,M(t)?t.split(`.`):t,0),r?n:n[0]}var je={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Me={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},Ne={location:0,threshold:.6,distance:100},Pe={useExtendedSearch:!1,getFn:Ae,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},R={...Me,...je,...Ne,...Pe},Fe=/[^ ]+/g;function Ie(e=1,t=3){let n=new Map,r=10**t;return{get(t){let i=t.match(Fe).length;if(n.has(i))return n.get(i);let a=1/i**(.5*e),o=parseFloat(Math.round(a*r)/r);return n.set(i,o),o},clear(){n.clear()}}}var z=class{constructor({getFn:e=R.getFn,fieldNormWeight:t=R.fieldNormWeight}={}){this.norm=Ie(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((e,t)=>{this._keysMap[e.id]=t})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,M(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){let t=this.size();M(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,n=this.size();t<n;t+=1)--this.records[t].i}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!F(e)||I(e))return;let n={v:e,i:t,n:this.norm.get(e)};this.records.push(n)}_addObject(e,t){let n={i:t,$:{}};this.keys.forEach((t,r)=>{let i=t.getFn?t.getFn(e):this.getFn(e,t.path);if(F(i)){if(j(i)){let e=[],t=[{nestedArrIndex:-1,value:i}];for(;t.length;){let{nestedArrIndex:n,value:r}=t.pop();if(F(r))if(M(r)&&!I(r)){let t={v:r,i:n,n:this.norm.get(r)};e.push(t)}else j(r)&&r.forEach((e,n)=>{t.push({nestedArrIndex:n,value:e})})}n.$[r]=e}else if(M(i)&&!I(i)){let e={v:i,n:this.norm.get(i)};n.$[r]=e}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}};function Le(e,t,{getFn:n=R.getFn,fieldNormWeight:r=R.fieldNormWeight}={}){let i=new z({getFn:n,fieldNormWeight:r});return i.setKeys(e.map(Oe)),i.setSources(t),i.create(),i}function Re(e,{getFn:t=R.getFn,fieldNormWeight:n=R.fieldNormWeight}={}){let{keys:r,records:i}=e,a=new z({getFn:t,fieldNormWeight:n});return a.setKeys(r),a.setIndexRecords(i),a}function B(e,{errors:t=0,currentLocation:n=0,expectedLocation:r=0,distance:i=R.distance,ignoreLocation:a=R.ignoreLocation}={}){let o=t/e.length;if(a)return o;let s=Math.abs(r-n);return i?o+s/i:s?1:o}function ze(e=[],t=R.minMatchCharLength){let n=[],r=-1,i=-1,a=0;for(let o=e.length;a<o;a+=1){let o=e[a];o&&r===-1?r=a:!o&&r!==-1&&(i=a-1,i-r+1>=t&&n.push([r,i]),r=-1)}return e[a-1]&&a-r>=t&&n.push([r,a-1]),n}var V=32;function Be(e,t,n,{location:r=R.location,distance:i=R.distance,threshold:a=R.threshold,findAllMatches:o=R.findAllMatches,minMatchCharLength:s=R.minMatchCharLength,includeMatches:c=R.includeMatches,ignoreLocation:l=R.ignoreLocation}={}){if(t.length>V)throw Error(Ce(V));let u=t.length,d=e.length,f=Math.max(0,Math.min(r,d)),p=a,m=f,h=s>1||c,g=h?Array(d):[],_;for(;(_=e.indexOf(t,m))>-1;){let e=B(t,{currentLocation:_,expectedLocation:f,distance:i,ignoreLocation:l});if(p=Math.min(e,p),m=_+u,h){let e=0;for(;e<u;)g[_+e]=1,e+=1}}m=-1;let v=[],y=1,b=u+d,x=1<<u-1;for(let r=0;r<u;r+=1){let a=0,s=b;for(;a<s;)B(t,{errors:r,currentLocation:f+s,expectedLocation:f,distance:i,ignoreLocation:l})<=p?a=s:b=s,s=Math.floor((b-a)/2+a);b=s;let c=Math.max(1,f-s+1),_=o?d:Math.min(f+s,d)+u,S=Array(_+2);S[_+1]=(1<<r)-1;for(let a=_;a>=c;--a){let o=a-1,s=n[e.charAt(o)];if(h&&(g[o]=+!!s),S[a]=(S[a+1]<<1|1)&s,r&&(S[a]|=(v[a+1]|v[a])<<1|1|v[a+1]),S[a]&x&&(y=B(t,{errors:r,currentLocation:o,expectedLocation:f,distance:i,ignoreLocation:l}),y<=p)){if(p=y,m=o,m<=f)break;c=Math.max(1,2*f-m)}}if(B(t,{errors:r+1,currentLocation:f,expectedLocation:f,distance:i,ignoreLocation:l})>p)break;v=S}let S={isMatch:m>=0,score:Math.max(.001,y)};if(h){let e=ze(g,s);e.length?c&&(S.indices=e):S.isMatch=!1}return S}function Ve(e){let t={};for(let n=0,r=e.length;n<r;n+=1){let i=e.charAt(n);t[i]=(t[i]||0)|1<<r-n-1}return t}var H=String.prototype.normalize?(e=>e.normalize(`NFD`).replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,``)):(e=>e),He=class{constructor(e,{location:t=R.location,threshold:n=R.threshold,distance:r=R.distance,includeMatches:i=R.includeMatches,findAllMatches:a=R.findAllMatches,minMatchCharLength:o=R.minMatchCharLength,isCaseSensitive:s=R.isCaseSensitive,ignoreDiacritics:c=R.ignoreDiacritics,ignoreLocation:l=R.ignoreLocation}={}){if(this.options={location:t,threshold:n,distance:r,includeMatches:i,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:s,ignoreDiacritics:c,ignoreLocation:l},e=s?e:e.toLowerCase(),e=c?H(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;let u=(e,t)=>{this.chunks.push({pattern:e,alphabet:Ve(e),startIndex:t})},d=this.pattern.length;if(d>V){let e=0,t=d%V,n=d-t;for(;e<n;)u(this.pattern.substr(e,V),e),e+=V;if(t){let e=d-V;u(this.pattern.substr(e),e)}}else u(this.pattern,0)}searchIn(e){let{isCaseSensitive:t,ignoreDiacritics:n,includeMatches:r}=this.options;if(e=t?e:e.toLowerCase(),e=n?H(e):e,this.pattern===e){let t={isMatch:!0,score:0};return r&&(t.indices=[[0,e.length-1]]),t}let{location:i,distance:a,threshold:o,findAllMatches:s,minMatchCharLength:c,ignoreLocation:l}=this.options,u=[],d=0,f=!1;this.chunks.forEach(({pattern:t,alphabet:n,startIndex:p})=>{let{isMatch:m,score:h,indices:g}=Be(e,t,n,{location:i+p,distance:a,threshold:o,findAllMatches:s,minMatchCharLength:c,includeMatches:r,ignoreLocation:l});m&&(f=!0),d+=h,m&&g&&(u=[...u,...g])});let p={isMatch:f,score:f?d/this.chunks.length:1};return f&&r&&(p.indices=u),p}},U=class{constructor(e){this.pattern=e}static isMultiMatch(e){return Ue(e,this.multiRegex)}static isSingleMatch(e){return Ue(e,this.singleRegex)}search(){}};function Ue(e,t){let n=e.match(t);return n?n[1]:null}var We=class extends U{constructor(e){super(e)}static get type(){return`exact`}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){let t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},Ge=class extends U{constructor(e){super(e)}static get type(){return`inverse-exact`}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){let t=e.indexOf(this.pattern)===-1;return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},Ke=class extends U{constructor(e){super(e)}static get type(){return`prefix-exact`}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){let t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},qe=class extends U{constructor(e){super(e)}static get type(){return`inverse-prefix-exact`}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){let t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},Je=class extends U{constructor(e){super(e)}static get type(){return`suffix-exact`}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){let t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},Ye=class extends U{constructor(e){super(e)}static get type(){return`inverse-suffix-exact`}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){let t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},Xe=class extends U{constructor(e,{location:t=R.location,threshold:n=R.threshold,distance:r=R.distance,includeMatches:i=R.includeMatches,findAllMatches:a=R.findAllMatches,minMatchCharLength:o=R.minMatchCharLength,isCaseSensitive:s=R.isCaseSensitive,ignoreDiacritics:c=R.ignoreDiacritics,ignoreLocation:l=R.ignoreLocation}={}){super(e),this._bitapSearch=new He(e,{location:t,threshold:n,distance:r,includeMatches:i,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:s,ignoreDiacritics:c,ignoreLocation:l})}static get type(){return`fuzzy`}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}},Ze=class extends U{constructor(e){super(e)}static get type(){return`include`}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,n,r=[],i=this.pattern.length;for(;(n=e.indexOf(this.pattern,t))>-1;)t=n+i,r.push([n,t-1]);let a=!!r.length;return{isMatch:a,score:a?0:1,indices:r}}},W=[We,Ze,Ke,qe,Ye,Je,Ge,Xe],Qe=W.length,$e=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,et=`|`;function tt(e,t={}){return e.split(et).map(e=>{let n=e.trim().split($e).filter(e=>e&&!!e.trim()),r=[];for(let e=0,i=n.length;e<i;e+=1){let i=n[e],a=!1,o=-1;for(;!a&&++o<Qe;){let e=W[o],n=e.isMultiMatch(i);n&&(r.push(new e(n,t)),a=!0)}if(!a)for(o=-1;++o<Qe;){let e=W[o],n=e.isSingleMatch(i);if(n){r.push(new e(n,t));break}}}return r})}var nt=new Set([Xe.type,Ze.type]),rt=class{constructor(e,{isCaseSensitive:t=R.isCaseSensitive,ignoreDiacritics:n=R.ignoreDiacritics,includeMatches:r=R.includeMatches,minMatchCharLength:i=R.minMatchCharLength,ignoreLocation:a=R.ignoreLocation,findAllMatches:o=R.findAllMatches,location:s=R.location,threshold:c=R.threshold,distance:l=R.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:n,includeMatches:r,minMatchCharLength:i,findAllMatches:o,ignoreLocation:a,location:s,threshold:c,distance:l},e=t?e:e.toLowerCase(),e=n?H(e):e,this.pattern=e,this.query=tt(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){let t=this.query;if(!t)return{isMatch:!1,score:1};let{includeMatches:n,isCaseSensitive:r,ignoreDiacritics:i}=this.options;e=r?e:e.toLowerCase(),e=i?H(e):e;let a=0,o=[],s=0;for(let r=0,i=t.length;r<i;r+=1){let i=t[r];o.length=0,a=0;for(let t=0,r=i.length;t<r;t+=1){let r=i[t],{isMatch:c,indices:l,score:u}=r.search(e);if(c){if(a+=1,s+=u,n){let e=r.constructor.type;nt.has(e)?o=[...o,...l]:o.push(l)}}else{s=0,a=0,o.length=0;break}}if(a){let e={isMatch:!0,score:s/a};return n&&(e.indices=o),e}}return{isMatch:!1,score:1}}},G=[];function it(...e){G.push(...e)}function K(e,t){for(let n=0,r=G.length;n<r;n+=1){let r=G[n];if(r.condition(e,t))return new r(e,t)}return new He(e,t)}var q={AND:`$and`,OR:`$or`},J={PATH:`$path`,PATTERN:`$val`},Y=e=>!!(e[q.AND]||e[q.OR]),at=e=>!!e[J.PATH],ot=e=>!j(e)&&P(e)&&!Y(e),st=e=>({[q.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function X(e,t,{auto:n=!0}={}){let r=e=>{let i=Object.keys(e),a=at(e);if(!a&&i.length>1&&!Y(e))return r(st(e));if(ot(e)){let r=a?e[J.PATH]:i[0],o=a?e[J.PATTERN]:e[r];if(!M(o))throw Error(Se(r));let s={keyId:L(r),pattern:o};return n&&(s.searcher=K(o,t)),s}let o={children:[],operator:i[0]};return i.forEach(t=>{let n=e[t];j(n)&&n.forEach(e=>{o.children.push(r(e))})}),o};return Y(e)||(e=st(e)),r(e)}function ct(e,{ignoreFieldNorm:t=R.ignoreFieldNorm}){e.forEach(e=>{let n=1;e.matches.forEach(({key:e,norm:r,score:i})=>{let a=e?e.weight:null;n*=(i===0&&a?2**-52:i)**+((a||1)*(t?1:r))}),e.score=n})}function lt(e,t){let n=e.matches;t.matches=[],F(n)&&n.forEach(e=>{if(!F(e.indices)||!e.indices.length)return;let{indices:n,value:r}=e,i={indices:n,value:r};e.key&&(i.key=e.key.src),e.idx>-1&&(i.refIndex=e.idx),t.matches.push(i)})}function ut(e,t){t.score=e.score}function dt(e,t,{includeMatches:n=R.includeMatches,includeScore:r=R.includeScore}={}){let i=[];return n&&i.push(lt),r&&i.push(ut),e.map(e=>{let{idx:n}=e,r={item:t[n],refIndex:n};return i.length&&i.forEach(t=>{t(e,r)}),r})}var Z=class{constructor(e,t={},n){this.options={...R,...t},this.options.useExtendedSearch,this._keyStore=new De(this.options.keys),this.setCollection(e,n)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof z))throw Error(xe);this._myIndex=t||Le(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){F(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){let t=[];for(let n=0,r=this._docs.length;n<r;n+=1){let i=this._docs[n];e(i,n)&&(this.removeAt(n),--n,--r,t.push(i))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){let{includeMatches:n,includeScore:r,shouldSort:i,sortFn:a,ignoreFieldNorm:o}=this.options,s=M(e)?M(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return ct(s,{ignoreFieldNorm:o}),i&&s.sort(a),N(t)&&t>-1&&(s=s.slice(0,t)),dt(s,this._docs,{includeMatches:n,includeScore:r})}_searchStringList(e){let t=K(e,this.options),{records:n}=this._myIndex,r=[];return n.forEach(({v:e,i:n,n:i})=>{if(!F(e))return;let{isMatch:a,score:o,indices:s}=t.searchIn(e);a&&r.push({item:e,idx:n,matches:[{score:o,value:e,norm:i,indices:s}]})}),r}_searchLogical(e){let t=X(e,this.options),n=(e,t,r)=>{if(!e.children){let{keyId:n,searcher:i}=e,a=this._findMatches({key:this._keyStore.get(n),value:this._myIndex.getValueForItemAtKeyId(t,n),searcher:i});return a&&a.length?[{idx:r,item:t,matches:a}]:[]}let i=[];for(let a=0,o=e.children.length;a<o;a+=1){let o=e.children[a],s=n(o,t,r);if(s.length)i.push(...s);else if(e.operator===q.AND)return[]}return i},r=this._myIndex.records,i={},a=[];return r.forEach(({$:e,i:r})=>{if(F(e)){let o=n(t,e,r);o.length&&(i[r]||(i[r]={idx:r,item:e,matches:[]},a.push(i[r])),o.forEach(({matches:e})=>{i[r].matches.push(...e)}))}}),a}_searchObjectList(e){let t=K(e,this.options),{keys:n,records:r}=this._myIndex,i=[];return r.forEach(({$:e,i:r})=>{if(!F(e))return;let a=[];n.forEach((n,r)=>{a.push(...this._findMatches({key:n,value:e[r],searcher:t}))}),a.length&&i.push({idx:r,item:e,matches:a})}),i}_findMatches({key:e,value:t,searcher:n}){if(!F(t))return[];let r=[];if(j(t))t.forEach(({v:t,i,n:a})=>{if(!F(t))return;let{isMatch:o,score:s,indices:c}=n.searchIn(t);o&&r.push({score:s,key:e,value:t,idx:i,norm:a,indices:c})});else{let{v:i,n:a}=t,{isMatch:o,score:s,indices:c}=n.searchIn(i);o&&r.push({score:s,key:e,value:i,norm:a,indices:c})}return r}};Z.version=`7.1.0`,Z.createIndex=Le,Z.parseIndex=Re,Z.config=R,Z.parseQuery=X,it(rt);function ft(e,t){if(!e.trim())return t.map(e=>({command:e,score:1,matchedIndices:[]}));let n=new Z(t,{keys:[{name:`label`,weight:.5},{name:`keywords`,weight:.3},{name:`id`,weight:.2}],threshold:.6,includeScore:!0,includeMatches:!0,ignoreLocation:!1,minMatchCharLength:1,findAllMatches:!1,shouldSort:!0,distance:100}).search(e).map(e=>{let t=e.score===void 0?0:1-e.score,n=[];if(e.matches){for(let t of e.matches)if(t.indices)for(let[e,r]of t.indices)for(let t=e;t<=r;t++)n.push(t)}return{command:e.item,score:t,matchedIndices:Array.from(new Set(n)).sort((e,t)=>e-t)}});return n.sort((e,t)=>{if(Math.abs(e.score-t.score)<.01){let n=e.command.usageCount??0;return(t.command.usageCount??0)-n}return t.score-e.score}),n}function pt(e){let t=e.trim();if(!t.startsWith(`goto `)&&!t.startsWith(`go to `))return{isFuzzyFindMode:!1,fuzzyFindQuery:``,quoteChar:null};let n=t.startsWith(`goto `)?t.slice(5):t.slice(6),r=null;if(n.startsWith(`"`))r=`"`;else if(n.startsWith(`'`))r=`'`;else return{isFuzzyFindMode:!1,fuzzyFindQuery:``,quoteChar:null};let i=n.slice(1),a=i;return i.endsWith(r)&&(a=i.slice(0,-1)),{isFuzzyFindMode:!0,fuzzyFindQuery:a,quoteChar:r}}function mt(e,t,n){let r=e.parentElement?.querySelector(`.command-palette-input-overlay`);if(r&&r.remove(),!n.isFuzzyFindMode||!n.quoteChar)return null;let i=document.createElement(`div`);i.className=`command-palette-input-overlay`,i.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    padding: 12px 16px;
    font-size: 16px;
    font-family: system-ui, -apple-system, sans-serif;
    white-space: pre;
    overflow: hidden;
    box-sizing: border-box;
    line-height: 1.5;
    border: none;
    background: transparent;
  `;let a=t.indexOf(n.quoteChar),o=t.substring(0,a+1),s=n.fuzzyFindQuery,c=document.createTextNode(o),l=document.createElement(`span`);if(l.style.cssText=`color: #1e293b;`,l.appendChild(c),i.appendChild(l),s){let e=document.createElement(`span`);e.style.cssText=`
      font-weight: bold;
      font-style: italic;
      color: #1e293b;
    `,e.textContent=s,i.appendChild(e)}return e.parentElement&&e.parentElement.appendChild(i),i}function ht(e,t,n,r,i){if(e.innerHTML=``,!t||t.trim()===``){let t=document.createElement(`div`);t.className=`command-palette-item command-palette-item-empty`,t.textContent=`Type to search...`,e.appendChild(t);return}if(n.length===0){let t=document.createElement(`div`);t.className=`command-palette-item command-palette-item-empty`,t.textContent=`No matches found`,e.appendChild(t);return}let a=document.createElement(`div`);a.className=`command-palette-item command-palette-item-empty`,a.textContent=`Search Results (${n.length})`,e.appendChild(a),n.forEach((t,n)=>{let a=document.createElement(`div`);a.className=`command-palette-item`,a.setAttribute(`role`,`option`),a.setAttribute(`aria-selected`,(n===r).toString()),n===r&&a.classList.add(`command-palette-item-selected`);let o=document.createElement(`div`);o.className=`command-palette-item-label`;let s=t.translation,c=``;if(t.matchedFields&&t.matchedFields.length>0){let e=t.matchedFields[0];if(e.field===`key`)c=`Key: ${s.key}`;else if(e.field===`context`)c=`Context: ${s.context||``}`;else if(e.field.startsWith(`values.`)){let t=e.field.replace(`values.`,``);c=`${t.toUpperCase()}: ${s.values?.[t]||``}`}else c=s.key||``}else c=s.key||``;o.textContent=c;let l=document.createElement(`div`);l.className=`command-palette-item-description`,l.textContent=`Row ${t.rowIndex+1}`,a.appendChild(l),a.appendChild(o),a.addEventListener(`click`,()=>{i(n)}),e.appendChild(a)})}var gt=class{overlay=null;container=null;input=null;list=null;footer=null;isOpen=!1;query=``;filteredCommands=[];selectedIndex=0;currentMode=`excel`;commandRegistry;callbacks;isFuzzyFindMode=!1;fuzzyFindQuery=``;fuzzyFindQuoteChar=null;fuzzyFindResults=[];fuzzyFindDebounceTimer=null;inputOverlay=null;constructor(e,t={}){this.commandRegistry=e,this.callbacks=t}open(e=`excel`){this.isOpen||(this.currentMode=e,this.isOpen=!0,this.query=``,this.selectedIndex=0,this.isFuzzyFindMode=!1,this.fuzzyFindQuery=``,this.fuzzyFindQuoteChar=null,this.fuzzyFindResults=[],this.createUI(),this.updateCommands(),this.attachEventListeners(),requestAnimationFrame(()=>{this.input?.focus()}))}close(){this.isOpen&&(this.isOpen=!1,this.query=``,this.selectedIndex=0,this.isFuzzyFindMode=!1,this.fuzzyFindQuery=``,this.fuzzyFindQuoteChar=null,this.fuzzyFindResults=[],this.fuzzyFindDebounceTimer!==null&&(clearTimeout(this.fuzzyFindDebounceTimer),this.fuzzyFindDebounceTimer=null),this.inputOverlay&&=(this.inputOverlay.remove(),null),this.detachEventListeners(),this.removeUI(),this.callbacks.onClose&&this.callbacks.onClose())}createUI(){this.overlay=document.createElement(`div`),this.overlay.className=`command-palette-overlay`,this.overlay.setAttribute(`role`,`dialog`),this.overlay.setAttribute(`aria-label`,`Command Palette`),this.overlay.setAttribute(`aria-modal`,`true`),this.container=document.createElement(`div`),this.container.className=`command-palette`,this.input=document.createElement(`input`),this.input.type=`text`,this.input.className=`command-palette-input`,this.input.setAttribute(`placeholder`,`Type a command or search...`),this.input.setAttribute(`aria-label`,`Command search input`),this.input.setAttribute(`autocomplete`,`off`),this.input.setAttribute(`spellcheck`,`false`),this.input.style.color=`transparent`,this.input.style.caretColor=`#1e293b`,this.list=document.createElement(`div`),this.list.className=`command-palette-list`,this.list.setAttribute(`role`,`listbox`),this.list.setAttribute(`aria-label`,`Command list`),this.footer=document.createElement(`div`),this.footer.className=`command-palette-footer`,this.footer.innerHTML=`
      <span class="command-palette-hint">
        <kbd>â†‘</kbd><kbd>â†“</kbd> Navigate
        <kbd>Enter</kbd> Execute
        <kbd>Esc</kbd> Close
      </span>
    `;let e=document.createElement(`div`);e.style.position=`relative`,e.appendChild(this.input),this.container.appendChild(e),this.container.appendChild(this.list),this.container.appendChild(this.footer),this.overlay.appendChild(this.container),document.body.appendChild(this.overlay),this.overlay.addEventListener(`click`,e=>{e.target===this.overlay&&this.close()})}removeUI(){this.inputOverlay&&=(this.inputOverlay.remove(),null),this.overlay&&(document.body.removeChild(this.overlay),this.overlay=null,this.container=null,this.input=null,this.list=null,this.footer=null)}attachEventListeners(){this.input&&(this.input.addEventListener(`input`,e=>{let t=e.target;this.handleInput(t.value)}),this.input.addEventListener(`keydown`,e=>{this.handleKeyDown(e)}))}detachEventListeners(){}handleInput(e){this.query=e,this.selectedIndex=0;let t=pt(e);t.isFuzzyFindMode?(this.isFuzzyFindMode=!0,this.fuzzyFindQuery=t.fuzzyFindQuery,this.fuzzyFindQuoteChar=t.quoteChar,this.updateInputStyling(e,t),this.updateFuzzyFindResults()):(this.isFuzzyFindMode=!1,this.fuzzyFindQuery=``,this.fuzzyFindQuoteChar=null,this.updateInputStyling(e,t),this.fuzzyFindResults=[],this.updateCommands())}updateInputStyling(e,t){this.input&&(this.inputOverlay&&=(this.inputOverlay.remove(),null),this.inputOverlay=mt(this.input,e,t))}updateFuzzyFindResults(){this.fuzzyFindDebounceTimer!==null&&clearTimeout(this.fuzzyFindDebounceTimer),this.fuzzyFindDebounceTimer=window.setTimeout(()=>{this.callbacks.onFindMatches&&this.fuzzyFindQuery&&this.fuzzyFindQuery.trim()?(this.fuzzyFindResults=this.callbacks.onFindMatches(this.fuzzyFindQuery.trim()),this.updateList()):(this.fuzzyFindResults=[],this.updateList()),this.fuzzyFindDebounceTimer=null},150)}updateFuzzyFindList(){this.list&&(this.fuzzyFindResults.length>0&&this.selectedIndex>=this.fuzzyFindResults.length&&(this.selectedIndex=0),ht(this.list,this.fuzzyFindQuery,this.fuzzyFindResults,this.selectedIndex,e=>{this.selectedIndex=e,this.executeSelectedCommand()}))}handleKeyDown(e){let t=this.isFuzzyFindMode?this.fuzzyFindResults.length-1:this.filteredCommands.length-1;e.key===`ArrowDown`?(e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,t),this.updateList(),this.updateFooter(),this.scrollToSelected()):e.key===`ArrowUp`?(e.preventDefault(),this.selectedIndex=Math.max(0,this.selectedIndex-1),this.updateList(),this.updateFooter(),this.scrollToSelected()):e.key===`Enter`?(e.preventDefault(),this.executeSelectedCommand()):e.key===`Escape`&&(e.preventDefault(),this.close())}updateCommands(){let e=this.commandRegistry.getCommands(this.currentMode);this.query.trim()?this.filteredCommands=ft(this.query,e):this.filteredCommands=this.commandRegistry.getPopularCommands(10,this.currentMode).map(e=>({command:e,score:1,matchedIndices:[]})),this.filteredCommands=this.filteredCommands.slice(0,50),this.updateList()}updateFooter(){if(this.footer)if(this.isFuzzyFindMode&&this.fuzzyFindResults.length>0){let e=this.selectedIndex+1,t=this.fuzzyFindResults.length;this.footer.innerHTML=`
        <span class="command-palette-hint">
          <kbd>â†‘</kbd><kbd>â†“</kbd> Navigate
          <kbd>Enter</kbd> Go to match
          <kbd>Esc</kbd> Close
        </span>
        <span class="command-palette-match-info">
          ${e}/${t} matches
        </span>
      `}else this.footer.innerHTML=`
        <span class="command-palette-hint">
          <kbd>â†‘</kbd><kbd>â†“</kbd> Navigate
          <kbd>Enter</kbd> Execute
          <kbd>Esc</kbd> Close
        </span>
      `}updateList(){if(this.list){if(this.list.innerHTML=``,this.isFuzzyFindMode){this.updateFuzzyFindList(),this.updateFooter();return}if(this.updateFooter(),this.filteredCommands.length===0){let e=document.createElement(`div`);e.className=`command-palette-item command-palette-item-empty`,e.textContent=`No commands found`,this.list.appendChild(e);return}this.filteredCommands.forEach((e,t)=>{let n=document.createElement(`div`);n.className=`command-palette-item`,n.setAttribute(`role`,`option`),n.setAttribute(`aria-selected`,(t===this.selectedIndex).toString()),t===this.selectedIndex&&n.classList.add(`command-palette-item-selected`);let r=document.createElement(`div`);if(r.className=`command-palette-item-label`,r.textContent=e.command.label,e.command.description){let t=document.createElement(`div`);t.className=`command-palette-item-description`,t.textContent=e.command.description,n.appendChild(t)}if(e.command.shortcut){let t=document.createElement(`div`);t.className=`command-palette-item-shortcut`,t.textContent=e.command.shortcut,n.appendChild(t)}n.appendChild(r),n.addEventListener(`click`,()=>{this.selectedIndex=t,this.executeSelectedCommand()}),this.list&&this.list.appendChild(n)})}}scrollToSelected(){if(!this.list)return;let e=this.list.querySelectorAll(`.command-palette-item`)[this.selectedIndex];if(e){if(typeof e.scrollIntoView==`function`)try{e.scrollIntoView({block:`nearest`,behavior:`smooth`})}catch{}if(this.list&&e.offsetTop!==void 0)try{let t=e.offsetTop,n=t+(e.offsetHeight||0),r=this.list.scrollTop||0,i=this.list.clientHeight||0,a=r+i;t<r?this.list.scrollTop=t:n>a&&(this.list.scrollTop=n-i)}catch{}}}executeSelectedCommand(){if(this.isFuzzyFindMode){if(this.fuzzyFindResults.length===0)return;let e=this.fuzzyFindResults[this.selectedIndex];e&&this.callbacks.onGotoMatch&&this.callbacks.onGotoMatch(e),this.close();return}let e=this.filteredCommands[this.selectedIndex];if(!e)return;let t=e.command;this.commandRegistry.incrementUsage(t.id);try{let e=this.parseCommandArgs(this.query,t.id);t.execute(e),this.callbacks.onCommandExecute&&this.callbacks.onCommandExecute(t,e)}catch(e){O.error(`Error executing command:`,e)}this.close()}parseCommandArgs(e,t){let n=e.trim().split(/\s+/);return t===`goto`&&(n[0]===`goto`||n[0]===`go`&&n[1]===`to`)?n[0]===`goto`?n.slice(1):n.slice(2):t===`search`&&n[0]===`search`||n[0]===t||n[0].startsWith(t)?n.slice(1):[]}isPaletteOpen(){return this.isOpen}getIsFuzzyFindMode(){return this.isFuzzyFindMode}getFuzzyFindQuery(){return this.fuzzyFindQuery}getFuzzyFindResults(){return[...this.fuzzyFindResults]}},_t=class{options;constructor(e){this.options=e}findMatches(e){if(!e.trim())return[];let t=e.toLowerCase().trim(),n=[];return this.options.translations.forEach((e,r)=>{let i=0,a=[],o=e.key.toLowerCase();if(o===t?(i+=50,a.push({field:`key`,matchedText:e.key,matchType:`exact`})):o.includes(t)?(i+=30,a.push({field:`key`,matchedText:e.key,matchType:`contains`})):this.fuzzyMatch(o,t)&&(i+=15,a.push({field:`key`,matchedText:e.key,matchType:`fuzzy`})),e.context){let n=e.context.toLowerCase();n===t?(i+=20,a.push({field:`context`,matchedText:e.context,matchType:`exact`})):n.includes(t)?(i+=20,a.push({field:`context`,matchedText:e.context,matchType:`contains`})):this.fuzzyMatch(n,t)&&(i+=10,a.push({field:`context`,matchedText:e.context,matchType:`fuzzy`}))}this.options.languages.forEach(n=>{let r=e.values[n]||``,o=r.toLowerCase();o===t?(i+=10,a.push({field:`values.${n}`,matchedText:r,matchType:`exact`})):o.includes(t)?(i+=10,a.push({field:`values.${n}`,matchedText:r,matchType:`contains`})):this.fuzzyMatch(o,t)&&(i+=5,a.push({field:`values.${n}`,matchedText:r,matchType:`fuzzy`}))}),i>0&&n.push({rowIndex:r,translation:e,score:i,matchedFields:a})}),n.sort((e,t)=>t.score===e.score?e.rowIndex-t.rowIndex:t.score-e.score),n}fuzzyMatch(e,t){if(t.length===0)return!0;if(t.length>e.length)return!1;let n=0;for(let r=0;r<e.length&&n<t.length;r++)e[r]===t[n]&&n++;return n===t.length}};function vt(e){if(!e||!e.trim())return null;let t=e.trim(),n=t.match(/^(\w+):(.+)$/);if(n){let[,e,t]=n;if(t.trim())return{keyword:t.trim(),column:e.toLowerCase()}}return{keyword:t}}function yt(e,t){if(!e||!t)return[];let n=e.toLowerCase(),r=t.toLowerCase(),i=[],a=0;for(;;){let e=n.indexOf(r,a);if(e===-1)break;for(let t=0;t<r.length;t++)i.push(e+t);a=e+1}return i}var Q=class{options;constructor(e){this.options=e}findMatches(e){if(!e.keyword)return[];let t=[],n=e.keyword.toLowerCase();return this.options.translations.forEach((r,i)=>{if(e.column){let a=this.getColumnIdForSearch(e.column);if(a){let o=this.getCellValue(r,a);if(o&&o.toLowerCase().includes(n)){let n=yt(o,e.keyword);t.push({rowIndex:i,columnId:a,matchedText:o,matchIndices:n})}}return}[`key`,`context`,...this.options.languages.map(e=>`values.${e}`)].forEach(a=>{let o=this.getCellValue(r,a);if(o&&o.toLowerCase().includes(n)){let n=yt(o,e.keyword);t.push({rowIndex:i,columnId:a,matchedText:o,matchIndices:n})}})}),t}getColumnIdForSearch(e){let t=e.toLowerCase();return t===`key`?`key`:t===`context`?`context`:this.options.languages.includes(t)?`values.${t}`:null}getCellValue(e,t){if(t===`key`)return e.key||null;if(t===`context`)return e.context||null;if(t.startsWith(`values.`)){let n=t.replace(`values.`,``);return e.values?.[n]||null}return null}static highlightText(e,t){if(!e||t.length===0)return $(e);let n=[...new Set(t)].sort((e,t)=>e-t),r=[],i=0,a=null;if(n.forEach((t,o)=>{if(!(a!==null&&t===n[o-1]+1)){if(a!==null){let t=n[o-1]+1;r.push(`<mark class="quick-search-highlight">${$(e.substring(a,t))}</mark>`),i=t}t>i&&r.push($(e.substring(i,t))),a=t}}),a!==null){let t=n[n.length-1]+1;r.push(`<mark class="quick-search-highlight">${$(e.substring(a,t))}</mark>`),i=t}return i<e.length&&r.push($(e.substring(i))),r.join(``)}};function $(e){let t=document.createElement(`div`);return t.textContent=e,t.innerHTML}var bt=class{overlay=null;input=null;statusText=null;isOpen=!1;callbacks;container;constructor(e,t={}){this.container=e,this.callbacks=t}open(){this.isOpen||(this.isOpen=!0,this.createUI(),requestAnimationFrame(()=>{this.input&&this.input.focus()}))}close(){this.isOpen&&(this.isOpen=!1,this.destroyUI(),this.callbacks.onClose&&this.callbacks.onClose())}updateStatus(e,t){this.statusText&&(t===0?this.statusText.textContent=`No matches`:this.statusText.textContent=`${e+1}/${t} matches`)}getQuery(){return this.input?.value||``}setQuery(e){this.input&&(this.input.value=e)}createUI(){this.overlay=document.createElement(`div`),this.overlay.className=`quick-search-overlay`,this.overlay.setAttribute(`role`,`dialog`),this.overlay.setAttribute(`aria-label`,`Quick Search`);let e=document.createElement(`div`);e.className=`quick-search-bar`;let t=document.createElement(`div`);t.className=`quick-search-label`,t.textContent=`/`,this.input=document.createElement(`input`),this.input.type=`text`,this.input.className=`quick-search-input`,this.input.placeholder=`Search... (e.g., keyword, key:keyword, en:keyword)`,this.input.setAttribute(`aria-label`,`Search query`),this.statusText=document.createElement(`div`),this.statusText.className=`quick-search-status`,this.statusText.textContent=``;let n=document.createElement(`button`);n.className=`quick-search-close`,n.textContent=`Ã—`,n.setAttribute(`aria-label`,`Close search`),n.addEventListener(`click`,()=>{this.close()}),this.input.addEventListener(`input`,()=>{this.callbacks.onSearch&&this.callbacks.onSearch(this.input?.value||``)}),this.input.addEventListener(`keydown`,e=>{e.key===`Escape`?(e.preventDefault(),e.stopPropagation(),this.close()):(e.key===`Enter`||e.code===`Enter`)&&(e.preventDefault(),e.stopPropagation(),this.callbacks.onNextMatch&&this.callbacks.onNextMatch())}),e.appendChild(t),e.appendChild(this.input),e.appendChild(this.statusText),e.appendChild(n),this.overlay.appendChild(e),this.container.appendChild(this.overlay),requestAnimationFrame(()=>{this.overlay&&this.overlay.classList.add(`quick-search-overlay-open`)})}destroyUI(){this.overlay&&(this.overlay.classList.remove(`quick-search-overlay-open`),setTimeout(()=>{this.overlay&&this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay),this.overlay=null,this.input=null,this.statusText=null},200))}isSearchMode(){return this.isOpen}},xt=class{statusBarElement=null;container;callbacks;constructor(e,t={}){this.container=e,this.callbacks=t}create(){this.statusBarElement||(this.statusBarElement=document.createElement(`div`),this.statusBarElement.className=`status-bar`,this.statusBarElement.setAttribute(`role`,`status`),this.statusBarElement.setAttribute(`aria-live`,`polite`),this.statusBarElement.setAttribute(`aria-atomic`,`true`),this.container.appendChild(this.statusBarElement))}update(e){if(this.statusBarElement||this.create(),!this.statusBarElement)return;let t=[];if(t.push(`[${e.mode}]`),e.rowIndex===null?t.push(`Row -/${e.totalRows}`):t.push(`Row ${e.rowIndex+1}/${e.totalRows}`),e.columnId){let n=this.getColumnDisplayName(e.columnId);t.push(`Col: ${n}`)}e.changesCount>0&&t.push(`${e.changesCount} change${e.changesCount===1?``:`s`}`),e.emptyCount>0&&t.push(`${e.emptyCount} empty`),e.duplicateCount>0&&t.push(`${e.duplicateCount} duplicate${e.duplicateCount===1?``:`s`}`);let n=t.join(` | `),r=e.command?`Command: ${e.command}`:``;this.statusBarElement.innerHTML=`
      <span class="status-bar-left">${n}</span>
      ${r?`<span class="status-bar-command">${r}</span>`:``}
    `,this.callbacks.onStatusUpdate&&this.callbacks.onStatusUpdate(e)}getColumnDisplayName(e){return e===`row-number`?`#`:e===`key`?`Key`:e===`context`?`Context`:e.startsWith(`values.`)?e.replace(`values.`,``).toUpperCase():e}destroy(){this.statusBarElement&&this.statusBarElement.parentElement&&(this.statusBarElement.parentElement.removeChild(this.statusBarElement),this.statusBarElement=null)}isVisible(){return this.statusBarElement!==null}},St=class{overlay=null;container=null;state={searchQuery:``,replaceQuery:``,isCaseSensitive:!1,isWholeWord:!1,isRegex:!1,matches:[],currentMatchIndex:-1,scope:`all`};translations=[];languages=[];callbacks;constructor(e){this.translations=e.translations,this.languages=e.languages,this.callbacks=e}open(e=`find`){if(this.overlay){this.setMode(e);return}this.createUI(),this.setMode(e),this.attach()}close(){this.overlay&&(this.overlay.remove(),this.overlay=null,this.container=null),this.detach(),this.callbacks.onClose&&this.callbacks.onClose()}setMode(e){if(!this.container)return;let t=this.container.querySelector(`.find-replace-replace-section`);if(t&&(t.style.display=e===`replace`?`block`:`none`),e===`replace`){let e=this.container.querySelector(`.find-replace-replace-input`);e&&setTimeout(()=>e.focus(),0)}}createUI(){this.overlay=document.createElement(`div`),this.overlay.className=`find-replace-overlay`,this.overlay.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 10000;
      display: flex;
      justify-content: center;
      padding-top: 20px;
    `,this.container=document.createElement(`div`),this.container.className=`find-replace-container`,this.container.style.cssText=`
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      padding: 16px;
      padding-top: 48px;
      min-width: 500px;
      max-width: 600px;
      position: relative;
    `;let e=document.createElement(`div`);e.className=`find-replace-find-section`,e.style.cssText=`
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
    `;let t=document.createElement(`input`);t.type=`text`,t.className=`find-replace-find-input`,t.placeholder=`Find`,t.style.cssText=`
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    `,t.value=this.state.searchQuery,t.addEventListener(`input`,e=>{this.state.searchQuery=e.target.value,this.performSearch()}),t.addEventListener(`keydown`,e=>{e.key===`Escape`?this.close():e.key===`Enter`&&!e.shiftKey?(e.preventDefault(),this.goToNextMatch()):e.key===`Enter`&&e.shiftKey&&(e.preventDefault(),this.goToPrevMatch())});let n=document.createElement(`div`);n.style.cssText=`display: flex; gap: 4px;`;let r=this.createButton(`â†‘`,`Previous`,()=>{this.goToPrevMatch()}),i=this.createButton(`â†“`,`Next`,()=>{this.goToNextMatch()});n.appendChild(r),n.appendChild(i),e.appendChild(t),e.appendChild(n);let a=document.createElement(`div`);a.className=`find-replace-replace-section`,a.style.cssText=`
      display: none;
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
    `;let o=document.createElement(`input`);o.type=`text`,o.className=`find-replace-replace-input`,o.placeholder=`Replace`,o.style.cssText=`
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    `,o.value=this.state.replaceQuery,o.addEventListener(`input`,e=>{let t=e.target.value;this.state.replaceQuery=t}),o.addEventListener(`keydown`,e=>{e.key===`Escape`?this.close():e.key===`Enter`&&!e.shiftKey?(e.preventDefault(),this.replaceCurrent()):e.key===`Enter`&&e.shiftKey&&(e.preventDefault(),this.replaceAll())});let s=document.createElement(`div`);s.style.cssText=`display: flex; gap: 4px;`;let c=this.createButton(`Replace`,`Replace current`,()=>{this.replaceCurrent()}),l=this.createButton(`Replace All`,`Replace all`,()=>{this.replaceAll()});s.appendChild(c),s.appendChild(l),a.appendChild(o),a.appendChild(s);let u=document.createElement(`div`);u.style.cssText=`
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 12px;
      font-size: 12px;
    `;let d=this.createCheckbox(`Aa`,`Match case`,this.state.isCaseSensitive,e=>{this.state.isCaseSensitive=e,this.performSearch()}),f=this.createCheckbox(`Ab`,`Match whole word`,this.state.isWholeWord,e=>{this.state.isWholeWord=e,this.performSearch()}),p=this.createCheckbox(`.*`,`Use regular expression`,this.state.isRegex,e=>{this.state.isRegex=e,this.performSearch()});u.appendChild(d),u.appendChild(f),u.appendChild(p);let m=document.createElement(`div`);m.className=`find-replace-result`,m.style.cssText=`
      font-size: 12px;
      color: #666;
      min-height: 20px;
    `;let h=document.createElement(`button`);h.textContent=`Ã—`,h.className=`find-replace-close-button`,h.style.cssText=`
      position: absolute;
      top: 8px;
      right: 8px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      pointer-events: auto;
    `,h.addEventListener(`click`,e=>{e.stopPropagation(),this.close()}),this.container.style.position=`relative`,this.container.appendChild(h),this.container.appendChild(e),this.container.appendChild(a),this.container.appendChild(u),this.container.appendChild(m),this.overlay.appendChild(this.container),document.body.appendChild(this.overlay),this.overlay.addEventListener(`click`,e=>{e.target===this.overlay&&this.close()}),setTimeout(()=>t.focus(),0)}createButton(e,t,n){let r=document.createElement(`button`);return r.textContent=e,r.title=t,r.style.cssText=`
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      font-size: 12px;
    `,r.addEventListener(`click`,n),r}createCheckbox(e,t,n,r){let i=document.createElement(`label`);i.style.cssText=`display: flex; align-items: center; gap: 4px; cursor: pointer;`,i.title=t;let a=document.createElement(`input`);a.type=`checkbox`,a.checked=n,a.style.cssText=`cursor: pointer;`,a.addEventListener(`change`,e=>{r(e.target.checked)});let o=document.createElement(`span`);return o.textContent=e,i.appendChild(a),i.appendChild(o),i}performSearch(){if(!this.state.searchQuery.trim()){this.state.matches=[],this.state.currentMatchIndex=-1,this.updateResult(),this.callbacks.onFind&&this.callbacks.onFind([]);return}let e=[],t=this.buildSearchPattern(this.state.searchQuery);this.translations.forEach((n,r)=>{[`key`,`context`,...this.languages.map(e=>`values.${e}`)].forEach(i=>{let a=this.getCellValue(n,i);a&&this.findMatchesInText(a,t).forEach(t=>{e.push({rowIndex:r,columnId:i,matchedText:a,matchIndex:t.index,matchLength:t.length})})})}),this.state.matches=e,this.state.currentMatchIndex=e.length>0?0:-1,this.updateResult(),this.callbacks.onFind&&this.callbacks.onFind(e)}buildSearchPattern(e){let t=e;if(this.state.isRegex)try{return new RegExp(t,this.state.isCaseSensitive?`g`:`gi`)}catch{t=this.escapeRegex(e)}else t=this.escapeRegex(e);return this.state.isWholeWord&&(t=`\\b${t}\\b`),new RegExp(t,this.state.isCaseSensitive?`g`:`gi`)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}findMatchesInText(e,t){let n=[],r;for(t.lastIndex=0;(r=t.exec(e))!==null;)n.push({index:r.index,length:r[0].length}),r.index===t.lastIndex&&t.lastIndex++;return n}getCellValue(e,t){if(t===`key`)return e.key;if(t===`context`)return e.context||null;if(t.startsWith(`values.`)){let n=t.replace(`values.`,``);return e.values[n]||null}return null}updateResult(){let e=this.container?.querySelector(`.find-replace-result`);e&&(this.state.matches.length===0?e.textContent=this.state.searchQuery?`No matches found`:``:e.textContent=`${this.state.currentMatchIndex+1} of ${this.state.matches.length} matches`)}goToNextMatch(){this.state.matches.length!==0&&(this.state.currentMatchIndex=(this.state.currentMatchIndex+1)%this.state.matches.length,this.updateResult(),this.navigateToMatch(this.state.matches[this.state.currentMatchIndex]))}goToPrevMatch(){this.state.matches.length!==0&&(this.state.currentMatchIndex=this.state.currentMatchIndex<=0?this.state.matches.length-1:this.state.currentMatchIndex-1,this.updateResult(),this.navigateToMatch(this.state.matches[this.state.currentMatchIndex]))}navigateToMatch(e){this.callbacks.onFind&&this.callbacks.onFind([e])}replaceCurrent(){if(this.state.currentMatchIndex<0||this.state.currentMatchIndex>=this.state.matches.length)return;let e=this.container?.querySelector(`.find-replace-replace-input`),t=e?e.value:this.state.replaceQuery,n=this.state.matches[this.state.currentMatchIndex];this.callbacks.onReplace&&this.callbacks.onReplace(n,t),this.performSearch()}replaceAll(){if(this.state.matches.length===0)return;let e=this.container?.querySelector(`.find-replace-replace-input`),t=e?e.value:this.state.replaceQuery;this.callbacks.onReplaceAll&&this.callbacks.onReplaceAll(this.state.matches,t),this.performSearch()}attach(){let e=e=>{e.key===`Escape`&&this.overlay&&this.close()};document.addEventListener(`keydown`,e),this.overlay.__escapeHandler=e}detach(){this.overlay&&this.overlay.__escapeHandler&&document.removeEventListener(`keydown`,this.overlay.__escapeHandler)}isOpen(){return this.overlay!==null}},Ct=class{options;constructor(e){this.options=e}filterEffect(t,n){let r=this;return e.Effect.gen(function*(i){switch(n.type){case`search`:return yield*i(r.applySearchFilterEffect(t,n.keyword||``));case`empty`:return yield*i(r.applyEmptyFilterEffect(t));case`changed`:return yield*i(r.applyChangedFilterEffect(t));case`duplicate`:return yield*i(r.applyDuplicateFilterEffect(t));default:return yield*i(e.Effect.succeed([...t]))}})}filter(t,n){let r=this.filterEffect(t,n);return e.Effect.runSync(e.Effect.match(r,{onFailure:e=>(O.warn(`Filter failed, returning original translations`,e),[...t]),onSuccess:e=>e}))}applySearchFilterEffect(t,n){let r=this;return e.Effect.gen(function*(i){let a=n.toLowerCase().trim();if(!a)return yield*i(e.Effect.succeed([...t]));let o=t.filter(e=>e.key.toLowerCase().includes(a)||e.context?.toLowerCase().includes(a)?!0:r.options.languages.some(t=>(e.values[t]||``).toLowerCase().includes(a)));return yield*i(e.Effect.succeed(o))})}applySearchFilter(t,n){let r=this.applySearchFilterEffect(t,n);return e.Effect.runSync(e.Effect.match(r,{onFailure:()=>[...t],onSuccess:e=>e}))}applyEmptyFilterEffect(t){let n=this;return e.Effect.gen(function*(r){let i=t.filter(e=>n.options.languages.some(t=>(e.values[t]||``).trim()===``));return yield*r(e.Effect.succeed(i))})}applyEmptyFilter(t){let n=this.applyEmptyFilterEffect(t);return e.Effect.runSync(e.Effect.match(n,{onFailure:()=>[...t],onSuccess:e=>e}))}applyChangedFilterEffect(t){let n=this;return e.Effect.gen(function*(r){let i=[];for(let e of t){if(n.options.changeTracker.hasChange(e.id,`key`)){i.push(e);continue}if(n.options.changeTracker.hasChange(e.id,`context`)){i.push(e);continue}let t=!1;for(let r of n.options.languages)if(n.options.changeTracker.hasChange(e.id,`values.${r}`)){t=!0;break}t&&i.push(e)}return yield*r(e.Effect.succeed(i))})}applyChangedFilter(t){let n=this.applyChangedFilterEffect(t);return e.Effect.runSync(e.Effect.match(n,{onFailure:()=>[...t],onSuccess:e=>e}))}applyDuplicateFilterEffect(t){return e.Effect.gen(function*(n){let r=new Map;t.forEach(e=>{let t=r.get(e.key)||0;r.set(e.key,t+1)});let i=t.filter(e=>(r.get(e.key)||0)>1);return yield*n(e.Effect.succeed(i))})}applyDuplicateFilter(t){let n=this.applyDuplicateFilterEffect(t);return e.Effect.runSync(e.Effect.match(n,{onFailure:()=>[...t],onSuccess:e=>e}))}},wt=class{currentSequence=``;commandType=`motion`;autoClearTimer=null;options;constructor(e={}){this.options={maxSequenceLength:e.maxSequenceLength??20,autoClearDelay:e.autoClearDelay??1e3,onCommandUpdate:e.onCommandUpdate??(()=>{})}}addKeyEffect(t){let n=this;return e.Effect.gen(function*(r){if(n.currentSequence.length>=n.options.maxSequenceLength)return yield*r(e.Effect.fail(new x({message:`Maximum sequence length (${n.options.maxSequenceLength}) exceeded`,code:`MAX_SEQUENCE_LENGTH_EXCEEDED`})));n.currentSequence+=t,n.updateCommandType();let i=n.createCommand();return n.options.onCommandUpdate(i),n.resetAutoClearTimer(),i})}addKey(t){let n=e.Effect.runSync(e.Effect.either(this.addKeyEffect(t)));if(n._tag===`Left`){let e=n.left;return e instanceof x||O.error(`VimCommandTracker: Unexpected error in addKey`,e),null}return n.right}completeCommandEffect(){let t=this;return e.Effect.gen(function*(n){if(!t.currentSequence)return yield*n(e.Effect.fail(new x({message:`No command sequence to complete`,code:`INVALID_KEY_SEQUENCE`})));let r=t.createCommand();return r.type=`complete`,t.options.onCommandUpdate(r),t.clear(),r})}completeCommand(){return e.Effect.runSync(e.Effect.match(this.completeCommandEffect(),{onFailure:e=>{throw e instanceof x?e:(O.error(`VimCommandTracker: Unexpected error in completeCommand`,e),new x({message:`Failed to complete command`,code:`INVALID_KEY_SEQUENCE`}))},onSuccess:e=>e}))}cancelCommandEffect(){return e.Effect.sync(()=>{this.clear()})}cancelCommand(){e.Effect.runSync(this.cancelCommandEffect())}getCurrentCommand(){return this.currentSequence?this.createCommand():null}clear(){this.currentSequence=``,this.commandType=`motion`,this.autoClearTimer!==null&&(clearTimeout(this.autoClearTimer),this.autoClearTimer=null),this.options.onCommandUpdate(null)}updateCommandType(){if(!this.currentSequence){this.commandType=`motion`;return}let e=this.currentSequence[this.currentSequence.length-1];if(/^\d+$/.test(this.currentSequence)){this.commandType=`number`;return}if([`d`,`y`,`c`].includes(e)){this.commandType=`operator`;return}if([`w`,`b`,`e`].includes(e)&&this.currentSequence.length>1){this.commandType=`text-object`;return}this.commandType=`motion`}createCommand(){return{sequence:this.currentSequence,type:this.commandType,description:this.getCommandDescription()}}getCommandDescription(){let e=this.currentSequence;if(e)return/^\d+$/.test(e)?`Repeat ${e} times`:{h:`Move left`,j:`Move down`,k:`Move up`,l:`Move right`,gg:`Go to top`,G:`Go to bottom`,0:`Go to line start`,$:`Go to line end`,dd:`Delete line`,yy:`Yank line`,p:`Paste`,u:`Undo`,cw:`Change word`,dw:`Delete word`,ciw:`Change inner word`,diw:`Delete inner word`}[e]||void 0}resetAutoClearTimer(){this.autoClearTimer!==null&&clearTimeout(this.autoClearTimer),this.autoClearTimer=window.setTimeout(()=>{this.clear()},this.options.autoClearDelay)}},Tt=class{overlay=null;input=null;container;options;history=[];historyIndex=-1;isVisible=!1;constructor(e){this.container=e.container,this.options={container:e.container,onExecute:e.onExecute??(()=>{}),onCancel:e.onCancel??(()=>{}),maxHistorySize:e.maxHistorySize??50,placeholder:e.placeholder??`Enter command...`},this.loadHistory()}showEffect(t){return e.Effect.sync(()=>{this.isVisible||=(this.historyIndex=-1,this.loadHistory(),this.createUI(),this.input&&(this.input.value=t||``,requestAnimationFrame(()=>{if(this.input){let e=t||``;this.input.value!==e&&(O.warn(`CommandLine: Input value was reset during show! Expected: "${e}", Got: "${this.input.value}"`),this.input.value=e),this.input.focus(),this.input.select()}})),!0)}).pipe(e.Effect.catchAll(t=>(O.error(`CommandLine: Failed to show`,t),e.Effect.fail(t))))}show(t){e.Effect.runSync(e.Effect.match(this.showEffect(t),{onFailure:e=>{O.error(`CommandLine: Failed to show`,e)},onSuccess:()=>{}}))}hideEffect(){return e.Effect.sync(()=>{this.hide()})}hide(){this.isVisible&&(this.overlay&&this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay),this.overlay=null,this.input=null,this.isVisible=!1,this.historyIndex=-1)}getVisible(){return this.isVisible}createUI(){this.overlay=document.createElement(`div`),this.overlay.className=`command-line-overlay`,this.overlay.setAttribute(`role`,`dialog`),this.overlay.setAttribute(`aria-label`,`Command Line`);let e=document.createElement(`div`);e.className=`command-line`,this.input=document.createElement(`input`),this.input.type=`text`,this.input.className=`command-line-input`,this.input.setAttribute(`placeholder`,this.options.placeholder),this.input.setAttribute(`aria-label`,`Command input`),this.input.setAttribute(`autocomplete`,`off`),this.input.setAttribute(`spellcheck`,`false`),this.attachInputListeners(),e.appendChild(this.input),this.overlay.appendChild(e),this.container.appendChild(this.overlay)}attachInputListeners(){if(!this.input){O.warn(`CommandLine: Cannot attach listeners - input is null`);return}this.input.addEventListener(`keydown`,e=>{e.key===`Enter`?(e.preventDefault(),e.stopPropagation(),this.executeCommand().catch(e=>{O.error(`CommandLine: executeCommand error (outer catch)`,e),this.hide()})):e.key===`Escape`?(e.preventDefault(),e.stopPropagation(),this.cancel()):e.key===`ArrowUp`?(e.preventDefault(),e.stopPropagation(),this.navigateHistory(-1),this.input&&requestAnimationFrame(()=>{this.input&&this.input.focus()})):e.key===`ArrowDown`&&(e.preventDefault(),e.stopPropagation(),this.navigateHistory(1),this.input&&requestAnimationFrame(()=>{this.input&&this.input.focus()}))}),this.overlay&&this.overlay.addEventListener(`click`,e=>{e.target===this.overlay&&this.cancel()})}executeCommandEffect(){let t=this;return e.Effect.gen(function*(n){if(!t.input)return yield*n(e.Effect.fail(new S({message:`Input element not found`,code:`INVALID_COMMAND`})));let r=t.input.value.trim();if(!r){t.hide();return}t.addToHistory(r);try{let i=t.options.onExecute(r);if(i instanceof Promise){let r=null,a=new Promise((e,t)=>{r=window.setTimeout(()=>{t(Error(`Command execution timeout (5s)`))},5e3)});try{yield*n(e.Effect.promise(()=>Promise.race([i.finally(()=>{r!==null&&(window.clearTimeout(r),r=null)}),a])))}catch(i){return r!==null&&(window.clearTimeout(r),r=null),O.error(`CommandLine: Command execution timeout or error`,i),t.hide(),yield*n(e.Effect.fail(new S({message:`Command execution failed: ${i instanceof Error?i.message:String(i)}`,code:`COMMAND_EXECUTION_FAILED`})))}}}catch(r){return O.error(`CommandLine: Command execution failed`,r),t.hide(),yield*n(e.Effect.fail(new S({message:`Command execution failed: ${r instanceof Error?r.message:String(r)}`,code:`COMMAND_EXECUTION_FAILED`})))}t.hide()}).pipe(e.Effect.catchAll(n=>(O.error(`CommandLine: Failed to execute command`,n),t.hide(),e.Effect.fail(n))))}async executeCommand(){let t=null;try{let n=new Promise((e,n)=>{t=window.setTimeout(()=>{n(Error(`Command execution timeout (5s)`))},5e3)});await Promise.race([e.Effect.runPromise(this.executeCommandEffect()).finally(()=>{t!==null&&(window.clearTimeout(t),t=null)}),n])}catch(e){t!==null&&(window.clearTimeout(t),t=null),O.error(`CommandLine: executeCommand failed`,e),this.hide()}}cancel(){this.options.onCancel(),this.hide()}navigateHistory(e){if(this.input&&(this.loadHistory(),this.history.length!==0)){if(this.historyIndex===-1)if(e<0)if(this.history.length>0)this.historyIndex=0;else return;else return;else this.historyIndex-=e;if(this.historyIndex<0){this.historyIndex=-1,this.input.value=``;return}else if(this.historyIndex>=this.history.length){this.historyIndex=this.history.length,this.input.value=``;return}if(this.historyIndex>=0&&this.historyIndex<this.history.length){let e=this.history[this.historyIndex];e&&typeof e==`string`?this.input?(this.input.value=e,requestAnimationFrame(()=>{this.input&&(this.input.value!==e&&(O.warn(`CommandLine: Input value was reset in Firefox! Expected: "${e}", Got: "${this.input.value}"`),this.input.value=e),this.input.focus(),this.input.setSelectionRange(0,this.input.value.length))})):O.warn(`CommandLine: Input element is null when setting history value`):this.input&&(this.input.value=``)}else this.input&&(this.input.value=``)}}addToHistory(e){let t=this.history.indexOf(e);t!==-1&&this.history.splice(t,1),this.history.unshift(e),this.history.length>this.options.maxHistorySize&&(this.history=this.history.slice(0,this.options.maxHistorySize)),this.saveHistory()}getHistory(){return[...this.history]}clearHistory(){this.history=[],this.historyIndex=-1,this.saveHistory()}saveHistory(){try{let e=JSON.stringify(this.history);localStorage.setItem(`commandLineHistory`,e)}catch(e){O.error(`Failed to save command line history`,e)}}loadHistory(){try{let e=localStorage.getItem(`commandLineHistory`);if(e){let t=JSON.parse(e);Array.isArray(t)?this.history=t:(O.warn(`CommandLine: Invalid history format in localStorage`,t),this.history=[])}else this.history=[]}catch(e){O.error(`Failed to load command line history`,e),this.history=[]}}destroy(){this.hide()}},Et=class{container;scrollElement=null;gridElement=null;headerElement=null;bodyElement=null;options;rowVirtualizer=null;virtualizerCleanup=null;renderScheduled=!1;resizeObserver=null;columnWidths=new Map;editableColumns=new Set;rowHeight=40;headerHeight=40;changeTracker=new k;undoRedoManager=new re;modifierKeyTracker=new ie;focusManager=new ae;cellEditor;keyboardHandlerModule;columnResizer;columnWidthCalculator;gridRenderer;commandRegistry;commandPalette;columnMinWidths=new Map;originalTranslations=[];currentTranslations=[];currentFilter=`none`;currentSearchKeyword=``;filterManager;currentGotoMatches=null;quickSearch=null;quickSearchUI=null;currentQuickSearchMatches=[];currentQuickSearchIndex=-1;statusBar=null;findReplace=null;vimCommandTracker=null;commandLine=null;vimKeyboardHandler=null;constructor(e){this.container=e.container,this.options=e,this.columnWidths=e.columnWidths||new Map,this.rowHeight=e.rowHeight||40,this.headerHeight=e.headerHeight||40,this.editableColumns=new Set([`key`,`context`]),e.languages.forEach(e=>{this.editableColumns.add(`values.${e}`)}),this.columnMinWidths.set(`key`,100),this.columnMinWidths.set(`context`,100),e.languages.forEach(e=>{this.columnMinWidths.set(`values.${e}`,80)}),this.originalTranslations=[...e.translations],this.currentTranslations=[...e.translations],this.changeTracker.initializeOriginalData(e.translations,e.languages),this.filterManager=new Ct({translations:e.translations,languages:e.languages,changeTracker:this.changeTracker}),this.cellEditor=new le(e.translations,this.changeTracker,this.undoRedoManager,{onCellChange:(t,n,r)=>{let i=this.currentTranslations.findIndex(e=>e.id===t);if(i!==-1){let e=this.currentTranslations[i],a=A(e);if(n===`key`)a.key=r;else if(n===`context`)a.context=r;else if(n.startsWith(`values.`)){let e=n.replace(`values.`,``);a.values[e]=r}this.currentTranslations[i]=a;let o=this.originalTranslations.findIndex(e=>e.id===t);if(o!==-1){let e=this.originalTranslations[o],t=A(e);if(n===`key`)t.key=r;else if(n===`context`)t.context=r;else if(n.startsWith(`values.`)){let e=n.replace(`values.`,``);t.values[e]=r}let i=[...this.originalTranslations];i[o]=t,this.originalTranslations=i}}this.updateCellStyle(t,n),this.updateStatusBar(),e.onCellChange&&e.onCellChange(t,n,r)},onEditStateChange:()=>{this.updateStatusBar()},onEditFinished:(e,t,n)=>{let r=this.currentTranslations.length-1,i=e;if(n===`down`)if(e<r)i=e+1;else{this.focusCell(e,t);return}else if(e>0)i=e-1;else{this.focusCell(e,t);return}this.focusCell(i,t),requestAnimationFrame(()=>{this.startEditingFromKeyboard(i,t)})},updateCellStyle:(e,t)=>{this.updateCellStyle(e,t)},updateCellContent:(e,t,n,r)=>{let i=e.getAttribute(`data-row-index`),a=i?parseInt(i,10):0;this.gridRenderer.updateCellContent(e,t,n,r,a)}}),this.commandRegistry=new me({onCommandExecuted:()=>{}}),this.registerDefaultCommands(),this.quickSearch=new Q({translations:e.translations,languages:e.languages}),this.quickSearchUI=new bt(this.container,{onSearch:e=>{this.handleQuickSearch(e)},onClose:()=>{this.closeQuickSearch()},onNextMatch:()=>{this.goToNextQuickSearchMatch()},onPrevMatch:()=>{this.goToPrevQuickSearchMatch()}}),this.commandPalette=new gt(this.commandRegistry,{onCommandExecute:()=>{},onClose:()=>{if(this.bodyElement){let e=this.focusManager.getFocusedCell();e&&this.focusCell(e.rowIndex,e.columnId)}},onFindMatches:e=>this.findMatches(e),onGotoMatch:e=>{this.gotoToMatch(e);let t=this.commandPalette.getFuzzyFindResults(),n=this.commandPalette.getFuzzyFindQuery(),r=t.map(e=>({rowIndex:e.rowIndex,translation:e.translation,score:e.score,matchedFields:e.matchedFields})),i=r.findIndex(t=>t.rowIndex===e.rowIndex);this.currentGotoMatches={keyword:n,matches:r,currentIndex:i===-1?0:i}}}),this.keyboardHandlerModule=new ue(this.modifierKeyTracker,this.focusManager,{onUndo:()=>this.handleUndo(),onRedo:()=>this.handleRedo(),onStartEditing:(e,t)=>{this.startEditingFromKeyboard(e,t)},getAllColumns:()=>[`key`,`context`,...e.languages.map(e=>`values.${e}`)],getMaxRowIndex:()=>e.translations.length-1,focusCell:(e,t)=>{this.focusCell(e,t)},onOpenCommandPalette:e=>{this.commandPalette.open(e)},onOpenQuickSearch:()=>{this.openQuickSearch()},onQuickSearchNext:()=>{this.goToNextQuickSearchMatch()},onQuickSearchPrev:()=>{this.goToPrevQuickSearchMatch()},isQuickSearchMode:()=>this.quickSearchUI?.isSearchMode()||!1,isEditableColumn:e=>this.editableColumns.has(e),isReadOnly:()=>this.options.readOnly||!1,onOpenFind:()=>{this.openFindReplace(`find`)},onOpenReplace:()=>{this.openFindReplace(`replace`)}}),this.columnWidthCalculator=new fe({columnWidths:this.columnWidths,columnMinWidths:this.columnMinWidths,languages:e.languages}),this.columnResizer=new de({columnWidths:this.columnWidths,columnMinWidths:this.columnMinWidths,languages:e.languages,callbacks:{onResize:(e,t)=>{this.applyColumnWidth(e,t)},onResizeEnd:()=>{this.rowVirtualizer&&this.bodyElement&&this.renderVirtualRows()}}}),this.gridRenderer=new pe({languages:e.languages,readOnly:e.readOnly,editableColumns:this.editableColumns,callbacks:{onCellDblClick:(e,t,n)=>{this.startEditing(e,t,n)},onCellFocus:(e,t)=>{this.focusManager.focusCell(e,t),this.updateStatusBar()},updateCellStyle:(e,t,n)=>{this.updateCellStyle(e,t,n)}}}),this.findReplace=new St({translations:e.translations,languages:e.languages,onFind:e=>{if(e.length>0){let t=e[0];this.gotoToFindMatch(t)}},onReplace:(e,t)=>{this.replaceFindMatch(e,t)},onReplaceAll:(e,t)=>{this.replaceAllFindMatches(e,t)},onClose:()=>{}}),this.vimCommandTracker=new wt({onCommandUpdate:e=>{this.updateStatusBar()}}),this.commandLine=new Tt({container:this.container,onExecute:async e=>{await this.executeCommandLineCommand(e)},onCancel:()=>{}})}render(){this.scrollElement&&this.container.contains(this.scrollElement)&&this.container.removeChild(this.scrollElement),this.scrollElement=document.createElement(`div`),this.scrollElement.className=`virtual-grid-scroll-container`,this.scrollElement.style.width=`100%`,this.scrollElement.style.height=`100%`,this.scrollElement.style.overflow=`auto`,this.scrollElement.style.position=`relative`,this.gridElement=document.createElement(`div`),this.gridElement.className=`virtual-grid`,this.gridElement.setAttribute(`role`,`grid`),this.options.readOnly&&this.gridElement.classList.add(`readonly`),this.headerElement=document.createElement(`div`),this.headerElement.className=`virtual-grid-header`,this.renderHeader(),this.gridElement.appendChild(this.headerElement),this.bodyElement=document.createElement(`div`),this.bodyElement.className=`virtual-grid-body`,this.bodyElement.style.position=`relative`,this.gridElement.appendChild(this.bodyElement),this.scrollElement.appendChild(this.gridElement),this.container.appendChild(this.scrollElement),this.observeContainerResize(),requestAnimationFrame(()=>{this.initVirtualScrolling()}),this.attachKeyboardListeners(),this.initStatusBar()}observeContainerResize(){this.resizeObserver&&this.resizeObserver.disconnect(),typeof ResizeObserver<`u`&&(this.resizeObserver=new ResizeObserver(()=>{this.headerElement&&(this.headerElement.innerHTML=``,this.renderHeader()),this.rowVirtualizer&&this.renderVirtualRows()}),this.resizeObserver.observe(this.container))}initVirtualScrolling(){if(!this.scrollElement||!this.bodyElement){O.error(`VirtualTableDiv: scrollElement or bodyElement is null`);return}let e=(()=>{if(this.scrollElement){let e=this.scrollElement.getBoundingClientRect();if(e.width>0&&e.height>0)return{width:e.width,height:e.height}}return{width:this.container.clientWidth||800,height:this.container.clientHeight||600}})();this.rowVirtualizer=new h({count:this.getFilteredTranslations().length,getScrollElement:()=>this.scrollElement,estimateSize:()=>this.rowHeight,scrollToFn:m,observeElementRect:l,observeElementOffset:f,initialRect:e,onChange:()=>{this.renderScheduled||(this.renderScheduled=!0,requestAnimationFrame(()=>{this.renderScheduled=!1,this.renderVirtualRows()}))}}),this.rowVirtualizer._willUpdate(),this.virtualizerCleanup=this.rowVirtualizer._didMount(),requestAnimationFrame(()=>{this.renderVirtualRows()})}renderVirtualRows(){if(!this.rowVirtualizer||!this.bodyElement)return;let e=null,t=this.cellEditor.getEditingCell();if(t){let n=this.bodyElement.querySelector(`[data-row-index="${t.rowIndex}"]`);if(n){let r=n.querySelector(`[data-column-id="${t.columnId}"]`);if(r){let n=r.querySelector(`input`);n&&(e={rowId:t.rowId,columnId:t.columnId,value:n.value})}}}this.bodyElement.innerHTML=``;let n=this.rowVirtualizer.getVirtualItems(),r=this.rowVirtualizer.getTotalSize();this.bodyElement.style.height=`${r}px`;let i,a=this.getContainerWidth();if(this.columnResizer.isResizingActive())i=this.columnWidthCalculator.calculateColumnWidths(a);else if(this.columnWidths.size>0)i=this.columnWidthCalculator.calculateColumnWidths(a);else{let e=this.getColumnWidthsFromHeader();if(e){let t=e.rowNumber+e.key+e.context+e.languages.slice(0,-1).reduce((e,t)=>e+t,0),n=this.columnMinWidths.get(`values.${this.options.languages[this.options.languages.length-1]}`)||80,r=Math.max(n,a-t);i={rowNumber:e.rowNumber,key:e.key,context:e.context,languages:[...e.languages.slice(0,-1),r]}}else i=this.columnWidthCalculator.calculateColumnWidths(a)}n.forEach(t=>{let n=this.getFilteredTranslations()[t.index];if(!n)return;let r=this.gridRenderer.createRow(n,t.index,i),o=a;if(r.style.position=`absolute`,r.style.top=`${t.start}px`,r.style.left=`0`,r.style.width=`${o}px`,r.style.minWidth=`${o}px`,r.style.maxWidth=`${o}px`,r.style.height=`${t.size}px`,r.setAttribute(`data-index`,t.index.toString()),this.bodyElement.appendChild(r),this.applyQuickSearchHighlight(r,t.index),e&&n.id===e.rowId){let n=r.querySelector(`[data-column-id="${e.columnId}"]`);n&&requestAnimationFrame(()=>{this.startEditing(t.index,e.columnId,n);let r=n.querySelector(`input`);r&&(r.value=e.value,r.focus(),r.select())})}this.rowVirtualizer.measureElement(r)})}renderHeader(){if(!this.headerElement)return;let e=document.createElement(`div`);e.className=`virtual-grid-header-row`,e.setAttribute(`role`,`row`);let t=this.getContainerWidth(),n;this.columnWidths.size>0?n=this.columnWidthCalculator.calculateColumnWidths(t):(n=this.columnWidthCalculator.calculateColumnWidths(t),this.columnWidths.set(`row-number`,n.rowNumber),this.columnWidths.set(`key`,n.key),this.columnWidths.set(`context`,n.context),this.options.languages.slice(0,-1).forEach((e,t)=>{let r=n.languages[t];this.columnWidths.set(`values.${e}`,r)}));let r=t;e.style.width=`${r}px`,e.style.minWidth=`${r}px`,e.style.maxWidth=`${r}px`;let i=this.gridRenderer.createHeaderCell(``,n.rowNumber,0,15,`row-number`);i.classList.add(`row-number-header`),e.appendChild(i);let a=this.gridRenderer.createHeaderCell(`Key`,n.key,n.rowNumber,10,`key`);this.columnResizer.addResizeHandle(a,`key`),e.appendChild(a);let o=this.gridRenderer.createHeaderCell(`Context`,n.context,n.rowNumber+n.key,10,`context`);this.columnResizer.addResizeHandle(o,`context`),e.appendChild(o),this.options.languages.forEach((t,r)=>{let i=n.languages[r],a=`values.${t}`,o=n.rowNumber+n.key+n.context,s=this.gridRenderer.createHeaderCell(t.toUpperCase(),i,o,0,a);this.columnResizer.addResizeHandle(s,a),e.appendChild(s)}),this.headerElement.appendChild(e)}applyColumnWidth(e,t){let n=this.getContainerWidth(),{columnWidths:r,totalWidth:i}=this.columnWidthCalculator.applyColumnWidth(e,t,n);if(this.headerElement){let e=this.headerElement.querySelector(`.virtual-grid-header-row`);e&&(e.style.width=`${i}px`,e.style.minWidth=`${i}px`,e.style.maxWidth=`${i}px`);let t=this.headerElement.querySelector(`[data-column-id="row-number"]`);t&&(t.style.width=`${r.rowNumber}px`,t.style.minWidth=`${r.rowNumber}px`,t.style.maxWidth=`${r.rowNumber}px`);let n=this.headerElement.querySelector(`[data-column-id="key"]`);n&&(n.style.width=`${r.key}px`,n.style.minWidth=`${r.key}px`,n.style.maxWidth=`${r.key}px`,n.style.left=`${r.rowNumber}px`);let a=this.headerElement.querySelector(`[data-column-id="context"]`);a&&(a.style.width=`${r.context}px`,a.style.minWidth=`${r.context}px`,a.style.maxWidth=`${r.context}px`,a.style.left=`${r.rowNumber+r.key}px`),this.options.languages.forEach((e,t)=>{let n=this.headerElement.querySelector(`[data-column-id="values.${e}"]`);if(n){let e=r.languages[t];n.style.width=`${e}px`,n.style.minWidth=`${e}px`,n.style.maxWidth=`${e}px`;let i=r.rowNumber+r.key+r.context;n.style.left=`${i}px`}})}this.bodyElement&&(this.bodyElement.querySelectorAll(`.virtual-grid-row`).forEach(e=>{let t=e;t.style.width=`${i}px`,t.style.minWidth=`${i}px`,t.style.maxWidth=`${i}px`}),this.bodyElement.querySelectorAll(`[data-column-id="row-number"]`).forEach(e=>{let t=e;t.style.width=`${r.rowNumber}px`,t.style.minWidth=`${r.rowNumber}px`,t.style.maxWidth=`${r.rowNumber}px`}),this.bodyElement.querySelectorAll(`[data-column-id="key"]`).forEach(e=>{let t=e;t.style.width=`${r.key}px`,t.style.minWidth=`${r.key}px`,t.style.maxWidth=`${r.key}px`,t.style.left=`${r.rowNumber}px`}),this.bodyElement.querySelectorAll(`[data-column-id="context"]`).forEach(e=>{let t=e;t.style.width=`${r.context}px`,t.style.minWidth=`${r.context}px`,t.style.maxWidth=`${r.context}px`,t.style.left=`${r.rowNumber+r.key}px`}),this.options.languages.forEach((e,t)=>{let n=this.bodyElement.querySelectorAll(`[data-column-id="values.${e}"]`),i=r.languages[t],a=r.rowNumber+r.key+r.context;n.forEach(e=>{let t=e;t.style.width=`${i}px`,t.style.minWidth=`${i}px`,t.style.maxWidth=`${i}px`,t.style.left=`${a}px`})}))}getColumnWidthsFromHeader(){if(!this.headerElement)return null;let e=this.headerElement.querySelector(`.virtual-grid-header-row`);if(!e)return null;let t=e.querySelectorAll(`.virtual-grid-header-cell`),n={rowNumber:0,key:0,context:0,languages:[]};return t.forEach(e=>{let t=e.getAttribute(`data-column-id`),r=e.offsetWidth||e.getBoundingClientRect().width;t===`row-number`?n.rowNumber=r:t===`key`?n.key=r:t===`context`?n.context=r:t&&t.startsWith(`values.`)&&n.languages.push(r)}),n.rowNumber>0&&n.key>0&&n.context>0&&n.languages.length===this.options.languages.length?n:null}startEditing(e,t,n){if(this.options.readOnly)return;let r=n.getAttribute(`data-row-id`);r&&(this.cellEditor.startEditing(e,t,r,n),this.updateStatusBar())}startEditingFromKeyboard(e,t){if(!this.bodyElement||!this.editableColumns.has(t)||this.options.readOnly)return;let n=this.bodyElement.querySelector(`[data-row-index="${e}"][data-column-id="${t}"]`);n&&this.startEditing(e,t,n)}stopEditing(){this.cellEditor.stopEditing(this.bodyElement||void 0),this.updateStatusBar()}updateCellStyle(e,t,n){if(!this.bodyElement)return;let r=n||this.bodyElement.querySelector(`[data-row-id="${e}"][data-column-id="${t}"]`);if(!r)return;let i=`${e}-${t}`;if(this.changeTracker.getChangesMap().has(i)?r.classList.add(`cell-dirty`):r.classList.remove(`cell-dirty`),t.startsWith(`values.`)){let n=this.currentTranslations.find(t=>t.id===e);if(n){let e=t.replace(`values.`,``),i=n.values[e]||``;!i||typeof i==`string`&&i.trim()===``?r.classList.add(`cell-empty`):r.classList.remove(`cell-empty`)}}}attachKeyboardListeners(){this.modifierKeyTracker.attach(),this.keyboardHandlerModule.attach(),this.vimKeyboardHandler=this.handleVimKeyboardEvent.bind(this),document.addEventListener(`keydown`,this.vimKeyboardHandler)}handleVimKeyboardEvent(e){if(this.commandLine?.getVisible()||this.cellEditor.getEditingCell()!==null||this.quickSearchUI?.isSearchMode()||this.commandPalette.isPaletteOpen()||document.querySelector(`.find-replace-overlay`))return;let t=e.target;if(!(t.tagName===`INPUT`||t.tagName===`TEXTAREA`||t.isContentEditable)&&!(e.ctrlKey||e.metaKey||e.altKey)){if(e.key===`:`||e.code===`Semicolon`){e.preventDefault(),e.stopPropagation(),this.commandLine&&(this.vimCommandTracker&&(this.vimCommandTracker.clear(),this.updateStatusBar()),this.commandLine.show());return}if(e.key===`Escape`){if(this.commandLine?.getVisible()){e.preventDefault(),e.stopPropagation(),this.commandLine.hide();return}this.vimCommandTracker&&(this.vimCommandTracker.cancelCommand(),this.updateStatusBar());return}e.key.length===1&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&!e.altKey&&this.vimCommandTracker&&(this.vimCommandTracker.addKey(e.key),this.updateStatusBar())}}focusCell(e,t){if(!this.bodyElement)return;this.focusManager.focusCell(e,t),this.updateStatusBar();let n=this.bodyElement.querySelector(`[data-row-index="${e}"][data-column-id="${t}"]`);if(!n&&this.rowVirtualizer){this.rowVirtualizer.scrollToIndex(e,{align:`start`,behavior:`auto`}),this.renderScheduled===!1&&this.renderVirtualRows();let r=(i=0)=>{if(!(i>20)){if(n=this.bodyElement.querySelector(`[data-row-index="${e}"][data-column-id="${t}"]`),n){n.focus(),n.dispatchEvent(new FocusEvent(`focus`,{bubbles:!0}));return}requestAnimationFrame(()=>{r(i+1)})}};r(0)}else n&&(n.focus(),n.dispatchEvent(new FocusEvent(`focus`,{bubbles:!0})))}handleUndo(){if(!this.undoRedoManager.canUndo())return;let e=this.undoRedoManager.undo();e&&(this.applyUndoRedoAction(e),this.updateStatusBar())}handleRedo(){if(!this.undoRedoManager.canRedo())return;let e=this.undoRedoManager.redo();e&&(this.applyUndoRedoAction(e),this.updateStatusBar())}applyUndoRedoAction(e){if(e.type!==`cell-change`){O.warn(`VirtualTableDiv: Invalid action type`,e.type);return}this.cellEditor.isEditing()&&this.stopEditing();let t=this.currentTranslations.findIndex(t=>t.id===e.rowId);if(t===-1){O.error(`VirtualTableDiv: Translation not found`,e.rowId);return}let n=this.currentTranslations[t],r=A(n);if(e.columnId===`key`)r.key=e.newValue;else if(e.columnId===`context`)r.context=e.newValue;else if(e.columnId.startsWith(`values.`)){let t=e.columnId.replace(`values.`,``);r.values[t]=e.newValue}else{O.error(`VirtualTableDiv: Invalid columnId`,e.columnId);return}let i=this.originalTranslations.findIndex(t=>t.id===e.rowId);if(i!==-1){let t=this.originalTranslations[i],n=A(t);if(e.columnId===`key`)n.key=e.newValue;else if(e.columnId===`context`)n.context=e.newValue;else if(e.columnId.startsWith(`values.`)){let t=e.columnId.replace(`values.`,``);n.values[t]=e.newValue}let r=[...this.originalTranslations];r[i]=n,this.originalTranslations=r}this.currentTranslations[t]=r;let a=this.bodyElement?.querySelector(`[data-row-id="${e.rowId}"][data-column-id="${e.columnId}"]`);if(a){let t=a.getAttribute(`data-row-index`),n=t?parseInt(t,10):0;this.gridRenderer.updateCellContent(a,e.rowId,e.columnId,e.newValue,n)}else this.updateCellStyle(e.rowId,e.columnId);let o=this.changeTracker.getOriginalValue(e.rowId,e.columnId),s=oe(e.columnId),c=se(this.currentTranslations,e.rowId,e.columnId,e.newValue);this.changeTracker.trackChange(e.rowId,e.columnId,s,o,e.newValue,c,()=>{this.updateCellStyle(e.rowId,e.columnId)}),this.options.onCellChange&&this.options.onCellChange(e.rowId,e.columnId,e.newValue),this.rowVirtualizer&&this.bodyElement&&this.renderVirtualRows()}getContainerWidth(){return this.container&&this.container.clientWidth>0?this.container.clientWidth:typeof window<`u`?window.innerWidth:1e3}setReadOnly(e){this.options={...this.options,readOnly:e},this.gridRenderer=new pe({languages:this.options.languages,readOnly:e,editableColumns:this.editableColumns,callbacks:{onCellDblClick:(e,t,n)=>{this.startEditing(e,t,n)},onCellFocus:(e,t)=>{this.focusManager.focusCell(e,t)},updateCellStyle:(e,t,n)=>{this.updateCellStyle(e,t,n)}}}),this.gridElement&&(e?this.gridElement.classList.add(`readonly`):this.gridElement.classList.remove(`readonly`)),this.bodyElement&&this.bodyElement.querySelectorAll(`.virtual-grid-cell`).forEach(t=>{let n=t.getAttribute(`data-column-id`),r=n&&this.editableColumns.has(n);e?t.setAttribute(`tabindex`,`-1`):t.setAttribute(`tabindex`,r?`0`:`-1`)}),this.bodyElement&&this.rowVirtualizer&&this.renderVirtualRows()}getChanges(){return this.changeTracker.getChanges()}registerDefaultCommands(){this.commandRegistry.registerCommand({id:`goto`,label:`Go to Row`,keywords:[`goto`,`go`,`row`,`line`,`jump`,`top`,`bottom`],category:`navigation`,description:`Navigate to a specific row number, or use 'top'/'bottom'`,execute:e=>{if(e&&e.length>0){let t=e[0].toLowerCase();if(t===`top`||t===`first`||t===`1`){this.gotoTop();return}if(t===`bottom`||t===`last`){this.gotoBottom();return}let n=parseInt(e[0],10);!isNaN(n)&&n>0&&this.gotoRow(n-1)}}}),this.commandRegistry.registerCommand({id:`goto-next`,label:`Go to Next Match`,keywords:[`goto`,`next`,`match`,`forward`],category:`navigation`,description:`Navigate to the next search match`,execute:()=>{this.gotoToNextMatch()}}),this.commandRegistry.registerCommand({id:`goto-prev`,label:`Go to Previous Match`,keywords:[`goto`,`prev`,`previous`,`back`,`backward`],category:`navigation`,description:`Navigate to the previous search match`,execute:()=>{this.gotoToPrevMatch()}}),this.commandRegistry.registerCommand({id:`search`,label:`Search`,keywords:[`search`,`find`,`query`],category:`filter`,description:`Search for keywords in translations`,execute:e=>{if(e&&e.length>0){let t=e.join(` `);this.searchKeyword(t)}}}),this.commandRegistry.registerCommand({id:`filter-empty`,label:`Filter: Empty Translations`,keywords:[`filter`,`empty`,`blank`,`missing`],category:`filter`,description:`Show only rows with empty translations`,execute:()=>{this.filterEmpty()}}),this.commandRegistry.registerCommand({id:`filter-changed`,label:`Filter: Changed Cells`,keywords:[`filter`,`changed`,`dirty`,`modified`],category:`filter`,description:`Show only rows with changed cells`,execute:()=>{this.filterChanged()}}),this.commandRegistry.registerCommand({id:`filter-duplicate`,label:`Filter: Duplicate Keys`,keywords:[`filter`,`duplicate`,`dupe`],category:`filter`,description:`Show only rows with duplicate keys`,execute:()=>{this.filterDuplicate()}}),this.commandRegistry.registerCommand({id:`clear-filter`,label:`Clear Filter`,keywords:[`clear`,`filter`,`reset`,`show`,`all`],category:`filter`,description:`Clear all filters and show all rows`,execute:()=>{this.clearFilter()}}),this.commandRegistry.registerCommand({id:`undo`,label:`Undo`,keywords:[`undo`,`revert`],shortcut:`Cmd+Z`,category:`edit`,description:`Undo last action`,execute:()=>{this.handleUndo()}}),this.commandRegistry.registerCommand({id:`redo`,label:`Redo`,keywords:[`redo`,`repeat`],shortcut:`Cmd+Y`,category:`edit`,description:`Redo last undone action`,execute:()=>{this.handleRedo()}}),this.commandRegistry.registerCommand({id:`readonly`,label:`Toggle Read Only`,keywords:[`readonly`,`read`,`only`,`lock`,`unlock`],category:`edit`,description:`Toggle read-only mode`,execute:()=>{let e=!this.options.readOnly;this.setReadOnly(e)}}),this.commandRegistry.registerCommand({id:`help`,label:`Show Help`,keywords:[`help`,`?`,`documentation`,`docs`],category:`help`,description:`Show keyboard shortcuts and help`,execute:()=>{this.showHelp()}})}gotoRow(e){let t=this.getFilteredTranslations();if(e<0||e>=t.length)return;this.rowVirtualizer&&this.rowVirtualizer.scrollToIndex(e,{align:`start`,behavior:`smooth`});let n=[`key`,`context`,...this.options.languages.map(e=>`values.${e}`)].find(e=>this.editableColumns.has(e));n&&setTimeout(()=>{this.focusCell(e,n)},300)}gotoTop(){this.gotoRow(0)}gotoBottom(){let e=this.getFilteredTranslations();if(e.length>0){let t=e.length-1;this.rowVirtualizer&&this.rowVirtualizer.scrollToIndex(t,{align:`end`,behavior:`smooth`});let n=[`key`,`context`,...this.options.languages.map(e=>`values.${e}`)].find(e=>this.editableColumns.has(e));n&&setTimeout(()=>{this.focusCell(t,n)},300)}}findMatches(e){return new _t({translations:this.getFilteredTranslations(),languages:this.options.languages}).findMatches(e)}gotoToMatch(e){if(this.gotoRow(e.rowIndex),this.currentGotoMatches){let t=this.currentGotoMatches.matches.findIndex(t=>t.rowIndex===e.rowIndex);t!==-1&&(this.currentGotoMatches.currentIndex=t)}}gotoToNextMatch(){if(!this.currentGotoMatches||this.currentGotoMatches.matches.length===0)return;let{matches:e,currentIndex:t}=this.currentGotoMatches,n=(t+1)%e.length,r=e[n];this.currentGotoMatches.currentIndex=n,this.gotoRow(r.rowIndex)}gotoToPrevMatch(){if(!this.currentGotoMatches||this.currentGotoMatches.matches.length===0)return;let{matches:e,currentIndex:t}=this.currentGotoMatches,n=t===0?e.length-1:t-1,r=e[n];this.currentGotoMatches.currentIndex=n,this.gotoRow(r.rowIndex)}openFindReplace(e){this.findReplace&&this.findReplace.open(e)}gotoToFindMatch(e){this.gotoRow(e.rowIndex),this.focusCell(e.rowIndex,e.columnId)}replaceFindMatch(e,t){let n=this.getFilteredTranslations();if(e.rowIndex<0||e.rowIndex>=n.length)return;let r=n[e.rowIndex],i=null;if(e.columnId===`key`)i=r.key;else if(e.columnId===`context`)i=r.context||null;else if(e.columnId.startsWith(`values.`)){let t=e.columnId.replace(`values.`,``);i=r.values[t]||null}if(i===null)return;let a=i.substring(0,e.matchIndex),o=i.substring(e.matchIndex+e.matchLength),s=a+t+o;if(e.columnId!==`key`){{let t=e.columnId,n=``;if(t===`context`)n=r.context||``;else if(t.startsWith(`values.`)){let e=t.replace(`values.`,``);n=r.values[e]||``}this.cellEditor.applyCellChange(r.id,t,n,s).catch(e=>{O.error(`Failed to apply cell change:`,e)})}this.updateStatusBar(),this.renderVirtualRows()}}replaceAllFindMatches(e,t){[...e].sort((e,t)=>e.rowIndex===t.rowIndex?t.matchIndex-e.matchIndex:t.rowIndex-e.rowIndex).forEach(e=>{this.replaceFindMatch(e,t)})}getCurrentMatchInfo(){return!this.currentGotoMatches||this.currentGotoMatches.matches.length===0?null:{current:this.currentGotoMatches.currentIndex+1,total:this.currentGotoMatches.matches.length}}getFilteredTranslations(){return this.filterManager.filter(this.originalTranslations,{type:this.currentFilter,keyword:this.currentSearchKeyword})}applyFilter(){this.currentTranslations=[...this.getFilteredTranslations()],this.rowVirtualizer&&this.initVirtualScrolling(),this.headerElement&&(this.headerElement.innerHTML=``,this.renderHeader()),this.renderVirtualRows(),this.updateStatusBar()}searchKeyword(e){this.currentSearchKeyword=e,this.currentFilter=e.trim()?`search`:`none`,this.applyFilter()}filterEmpty(){this.currentFilter=`empty`,this.currentSearchKeyword=``,this.applyFilter()}filterChanged(){this.currentFilter=`changed`,this.currentSearchKeyword=``,this.applyFilter()}filterDuplicate(){this.currentFilter=`duplicate`,this.currentSearchKeyword=``,this.applyFilter()}clearFilter(){this.currentFilter=`none`,this.currentSearchKeyword=``,this.currentTranslations=[...this.originalTranslations],this.applyFilter()}showHelp(){let e=document.querySelector(`.help-modal-overlay`);if(e&&e.remove(),!document.querySelector(`link[href*="help-modal.css"]`)){let e=document.createElement(`link`);e.rel=`stylesheet`,e.href=new URL(`data:text/css;base64,LyoqCiAqIEhlbHAgTW9kYWwg7Iqk7YOA7J28CiAqIFZTIENvZGUg7Iqk7YOA7J287J2YIOuPhOybgOunkCDrqqjri6wKICovCgouaGVscC1tb2RhbC1vdmVybGF5IHsKICBwb3NpdGlvbjogZml4ZWQ7CiAgdG9wOiAwOwogIGxlZnQ6IDA7CiAgcmlnaHQ6IDA7CiAgYm90dG9tOiAwOwogIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC40KTsKICB6LWluZGV4OiAxMDAxOyAvKiBDb21tYW5kIFBhbGV0dGXrs7Tri6Qg7JyE7JeQIO2RnOyLnCAqLwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBhbmltYXRpb246IGZhZGVJbiAwLjE1cyBlYXNlLW91dDsKfQoKQGtleWZyYW1lcyBmYWRlSW4gewogIGZyb20gewogICAgb3BhY2l0eTogMDsKICB9CiAgdG8gewogICAgb3BhY2l0eTogMTsKICB9Cn0KCi5oZWxwLW1vZGFsIHsKICB3aWR0aDogOTAlOwogIG1heC13aWR0aDogNzAwcHg7CiAgbWF4LWhlaWdodDogODB2aDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBib3gtc2hhZG93OiAwIDhweCAzMnB4IHJnYmEoMCwgMCwgMCwgMC4yKTsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgYW5pbWF0aW9uOiBzbGlkZURvd24gMC4xNXMgZWFzZS1vdXQ7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKfQoKQGtleWZyYW1lcyBzbGlkZURvd24gewogIGZyb20gewogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0yMHB4KTsKICAgIG9wYWNpdHk6IDA7CiAgfQogIHRvIHsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsKICAgIG9wYWNpdHk6IDE7CiAgfQp9CgouaGVscC1tb2RhbC1oZWFkZXIgewogIHBhZGRpbmc6IDIwcHggMjRweDsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2UyZThmMDsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGJhY2tncm91bmQtY29sb3I6ICNmOGZhZmM7Cn0KCi5oZWxwLW1vZGFsLXRpdGxlIHsKICBmb250LXNpemU6IDIwcHg7CiAgZm9udC13ZWlnaHQ6IDYwMDsKICBjb2xvcjogIzFlMjkzYjsKICBtYXJnaW46IDA7Cn0KCi5oZWxwLW1vZGFsLWNsb3NlIHsKICBiYWNrZ3JvdW5kOiBub25lOwogIGJvcmRlcjogbm9uZTsKICBmb250LXNpemU6IDI0cHg7CiAgY29sb3I6ICM2NDc0OGI7CiAgY3Vyc29yOiBwb2ludGVyOwogIHBhZGRpbmc6IDA7CiAgd2lkdGg6IDMycHg7CiAgaGVpZ2h0OiAzMnB4OwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjFzOwp9CgouaGVscC1tb2RhbC1jbG9zZTpob3ZlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2UyZThmMDsKICBjb2xvcjogIzFlMjkzYjsKfQoKLmhlbHAtbW9kYWwtY29udGVudCB7CiAgZmxleDogMTsKICBvdmVyZmxvdy15OiBhdXRvOwogIHBhZGRpbmc6IDI0cHg7Cn0KCi5oZWxwLW1vZGFsLXNlY3Rpb24gewogIG1hcmdpbi1ib3R0b206IDMycHg7Cn0KCi5oZWxwLW1vZGFsLXNlY3Rpb246bGFzdC1jaGlsZCB7CiAgbWFyZ2luLWJvdHRvbTogMDsKfQoKLmhlbHAtbW9kYWwtc2VjdGlvbi10aXRsZSB7CiAgZm9udC1zaXplOiAxNnB4OwogIGZvbnQtd2VpZ2h0OiA2MDA7CiAgY29sb3I6ICMxZTI5M2I7CiAgbWFyZ2luOiAwIDAgMTZweCAwOwogIHBhZGRpbmctYm90dG9tOiA4cHg7CiAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICNlMmU4ZjA7Cn0KCi5oZWxwLW1vZGFsLXNob3J0Y3V0LWxpc3QgewogIGxpc3Qtc3R5bGU6IG5vbmU7CiAgcGFkZGluZzogMDsKICBtYXJnaW46IDA7Cn0KCi5oZWxwLW1vZGFsLXNob3J0Y3V0LWl0ZW0gewogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgcGFkZGluZzogMTJweCAwOwogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZjFmNWY5Owp9CgouaGVscC1tb2RhbC1zaG9ydGN1dC1pdGVtOmxhc3QtY2hpbGQgewogIGJvcmRlci1ib3R0b206IG5vbmU7Cn0KCi5oZWxwLW1vZGFsLXNob3J0Y3V0LWRlc2NyaXB0aW9uIHsKICBmb250LXNpemU6IDE0cHg7CiAgY29sb3I6ICM0NzU1Njk7CiAgZmxleDogMTsKfQoKLmhlbHAtbW9kYWwtc2hvcnRjdXQta2V5cyB7CiAgZGlzcGxheTogZmxleDsKICBnYXA6IDRweDsKICBhbGlnbi1pdGVtczogY2VudGVyOwp9CgouaGVscC1tb2RhbC1zaG9ydGN1dC1rZXkgewogIHBhZGRpbmc6IDRweCA4cHg7CiAgYmFja2dyb3VuZC1jb2xvcjogI2YxZjVmOTsKICBib3JkZXI6IDFweCBzb2xpZCAjZTJlOGYwOwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBmb250LXNpemU6IDEycHg7CiAgZm9udC1mYW1pbHk6IHN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgc2Fucy1zZXJpZjsKICBjb2xvcjogIzFlMjkzYjsKICBib3gtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLCAwLCAwLCAwLjEpOwogIGZvbnQtd2VpZ2h0OiA1MDA7Cn0KCi5oZWxwLW1vZGFsLXNob3J0Y3V0LWtleS1zZXBhcmF0b3IgewogIGNvbG9yOiAjOTRhM2I4OwogIGZvbnQtc2l6ZTogMTJweDsKICBtYXJnaW46IDAgMnB4Owp9CgouaGVscC1tb2RhbC1jb21tYW5kLWxpc3QgewogIGxpc3Qtc3R5bGU6IG5vbmU7CiAgcGFkZGluZzogMDsKICBtYXJnaW46IDA7Cn0KCi5oZWxwLW1vZGFsLWNvbW1hbmQtaXRlbSB7CiAgcGFkZGluZzogMTJweCAwOwogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZjFmNWY5Owp9CgouaGVscC1tb2RhbC1jb21tYW5kLWl0ZW06bGFzdC1jaGlsZCB7CiAgYm9yZGVyLWJvdHRvbTogbm9uZTsKfQoKLmhlbHAtbW9kYWwtY29tbWFuZC1uYW1lIHsKICBmb250LXNpemU6IDE0cHg7CiAgZm9udC13ZWlnaHQ6IDUwMDsKICBjb2xvcjogIzFlMjkzYjsKICBtYXJnaW4tYm90dG9tOiA0cHg7CiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjFmNWY5OwogIHBhZGRpbmc6IDJweCA2cHg7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKfQoKLmhlbHAtbW9kYWwtY29tbWFuZC1kZXNjcmlwdGlvbiB7CiAgZm9udC1zaXplOiAxM3B4OwogIGNvbG9yOiAjNjQ3NDhiOwogIG1hcmdpbi10b3A6IDRweDsKfQoKLyog7Iqk7YGs66Gk67CUIOyKpO2DgOydvCAqLwouaGVscC1tb2RhbC1jb250ZW50Ojotd2Via2l0LXNjcm9sbGJhciB7CiAgd2lkdGg6IDhweDsKfQoKLmhlbHAtbW9kYWwtY29udGVudDo6LXdlYmtpdC1zY3JvbGxiYXItdHJhY2sgewogIGJhY2tncm91bmQ6ICNmMWY1Zjk7Cn0KCi5oZWxwLW1vZGFsLWNvbnRlbnQ6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsKICBiYWNrZ3JvdW5kOiAjY2JkNWUxOwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQoKLmhlbHAtbW9kYWwtY29udGVudDo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWI6aG92ZXIgewogIGJhY2tncm91bmQ6ICM5NGEzYjg7Cn0KCgoKCg==`,``+{}.url).href,document.head.appendChild(e)}let t=document.createElement(`div`);t.className=`help-modal-overlay`,t.setAttribute(`role`,`dialog`),t.setAttribute(`aria-label`,`Keyboard Shortcuts Help`),t.setAttribute(`aria-modal`,`true`);let n=document.createElement(`div`);n.className=`help-modal`;let r=document.createElement(`div`);r.className=`help-modal-header`;let i=document.createElement(`h2`);i.className=`help-modal-title`,i.textContent=`Keyboard Shortcuts`;let a=document.createElement(`button`);a.className=`help-modal-close`,a.innerHTML=`Ã—`,a.setAttribute(`aria-label`,`Close`),a.onclick=()=>t.remove(),r.appendChild(i),r.appendChild(a);let o=document.createElement(`div`);o.className=`help-modal-content`;let s=document.createElement(`div`);s.className=`help-modal-section`;let c=document.createElement(`h3`);c.className=`help-modal-section-title`,c.textContent=`Keyboard Shortcuts`,s.appendChild(c);let l=document.createElement(`ul`);l.className=`help-modal-shortcut-list`;let u=navigator.platform.toUpperCase().indexOf(`MAC`)>=0?`Cmd`:`Ctrl`;[{description:`Open Command Palette`,keys:[u,`K`]},{description:`Undo`,keys:[u,`Z`]},{description:`Redo`,keys:[u,`Y`]},{description:`Navigate to next cell`,keys:[`Tab`]},{description:`Navigate to next row (in language columns)`,keys:[`Enter`]},{description:`Navigate cells`,keys:[`Arrow`,`Keys`]},{description:`Edit cell`,keys:[`Double`,`Click`]}].forEach(e=>{let t=document.createElement(`li`);t.className=`help-modal-shortcut-item`;let n=document.createElement(`span`);n.className=`help-modal-shortcut-description`,n.textContent=e.description;let r=document.createElement(`div`);r.className=`help-modal-shortcut-keys`,e.keys.forEach((e,t)=>{if(t>0){let e=document.createElement(`span`);e.className=`help-modal-shortcut-key-separator`,e.textContent=`+`,r.appendChild(e)}let n=document.createElement(`kbd`);n.className=`help-modal-shortcut-key`,n.textContent=e,r.appendChild(n)}),t.appendChild(n),t.appendChild(r),l.appendChild(t)}),s.appendChild(l),o.appendChild(s);let d=document.createElement(`div`);d.className=`help-modal-section`;let f=document.createElement(`h3`);f.className=`help-modal-section-title`,f.textContent=`Available Commands`,d.appendChild(f);let p=document.createElement(`ul`);p.className=`help-modal-command-list`,[{name:`goto <number>`,description:`Navigate to a specific row number`},{name:`goto top`,description:`Navigate to the first row`},{name:`goto bottom`,description:`Navigate to the last row`},{name:`search <keyword>`,description:`Search for keywords in translations`},{name:`filter empty`,description:`Show only rows with empty translations`},{name:`filter changed`,description:`Show only rows with changed cells`},{name:`filter duplicate`,description:`Show only rows with duplicate keys`},{name:`clear filter`,description:`Clear all filters and show all rows`},{name:`undo`,description:`Undo last action`},{name:`redo`,description:`Redo last undone action`},{name:`readonly`,description:`Toggle read-only mode`},{name:`help`,description:`Show this help dialog`}].forEach(e=>{let t=document.createElement(`li`);t.className=`help-modal-command-item`;let n=document.createElement(`div`);n.className=`help-modal-command-name`,n.textContent=e.name;let r=document.createElement(`div`);r.className=`help-modal-command-description`,r.textContent=e.description,t.appendChild(n),t.appendChild(r),p.appendChild(t)}),d.appendChild(p),o.appendChild(d),n.appendChild(r),n.appendChild(o),t.appendChild(n),document.body.appendChild(t),t.addEventListener(`click`,e=>{e.target===t&&t.remove()});let m=e=>{e.key===`Escape`&&(t.remove(),document.removeEventListener(`keydown`,m))};document.addEventListener(`keydown`,m);let h=new MutationObserver(()=>{document.body.contains(t)||(document.removeEventListener(`keydown`,m),h.disconnect())});h.observe(document.body,{childList:!0,subtree:!0})}clearChanges(){this.changeTracker.clearChanges((e,t)=>{this.updateCellStyle(e,t)})}openQuickSearch(){this.quickSearchUI&&this.quickSearchUI.open()}closeQuickSearch(){this.quickSearchUI&&this.quickSearchUI.close(),this.currentQuickSearchMatches=[],this.currentQuickSearchIndex=-1,this.bodyElement&&this.renderVirtualRows()}handleQuickSearch(e){if(!this.quickSearch||!this.quickSearchUI)return;let t=vt(e);if(!t){this.currentQuickSearchMatches=[],this.currentQuickSearchIndex=-1,this.quickSearchUI.updateStatus(0,0),this.bodyElement&&this.renderVirtualRows();return}let n=this.quickSearch.findMatches(t);this.currentQuickSearchMatches=n,this.currentQuickSearchIndex=n.length>0?0:-1,n.length>0?(this.quickSearchUI.updateStatus(this.currentQuickSearchIndex,n.length),this.goToQuickSearchMatch(n[0])):this.quickSearchUI.updateStatus(0,0),this.bodyElement&&this.renderVirtualRows()}goToNextQuickSearchMatch(){if(this.currentQuickSearchMatches.length===0)return;(this.currentQuickSearchIndex<0||this.currentQuickSearchIndex>=this.currentQuickSearchMatches.length)&&(this.currentQuickSearchIndex=0),this.currentQuickSearchIndex=(this.currentQuickSearchIndex+1)%this.currentQuickSearchMatches.length;let e=this.currentQuickSearchMatches[this.currentQuickSearchIndex];this.goToQuickSearchMatch(e),this.quickSearchUI&&this.quickSearchUI.updateStatus(this.currentQuickSearchIndex,this.currentQuickSearchMatches.length)}goToPrevQuickSearchMatch(){if(this.currentQuickSearchMatches.length===0)return;this.currentQuickSearchIndex=this.currentQuickSearchIndex<=0?this.currentQuickSearchMatches.length-1:this.currentQuickSearchIndex-1;let e=this.currentQuickSearchMatches[this.currentQuickSearchIndex];this.goToQuickSearchMatch(e),this.quickSearchUI&&this.quickSearchUI.updateStatus(this.currentQuickSearchIndex,this.currentQuickSearchMatches.length)}goToQuickSearchMatch(e){if(this.rowVirtualizer&&this.scrollElement)if(this.rowVirtualizer.getVirtualItems().find(t=>t.index===e.rowIndex)&&this.bodyElement){let t=this.bodyElement.querySelector(`[data-index="${e.rowIndex}"]`);t&&t.scrollIntoView({behavior:`auto`,block:`center`})}else{let t=e.rowIndex*this.rowHeight;this.scrollElement.scrollTop=t-this.scrollElement.clientHeight/2}requestAnimationFrame(()=>{this.focusCell(e.rowIndex,e.columnId),this.bodyElement&&this.renderVirtualRows()})}applyQuickSearchHighlight(e,t){this.currentQuickSearchMatches.length!==0&&(e.querySelectorAll(`.virtual-grid-cell`).forEach(e=>{e.classList.remove(`quick-search-matched`,`quick-search-current-match`);let t=e.querySelector(`.virtual-grid-cell-content`);if(t){let e=t.getAttribute(`data-original-text`);e!==null&&(t.textContent=e,t.removeAttribute(`data-original-text`))}}),this.currentQuickSearchMatches.forEach(n=>{if(n.rowIndex!==t)return;let r=e.querySelector(`[data-column-id="${n.columnId}"]`);if(!r)return;let i=r.querySelector(`.virtual-grid-cell-content`);i&&(i.getAttribute(`data-original-text`)||i.setAttribute(`data-original-text`,n.matchedText),i.innerHTML=Q.highlightText(n.matchedText,n.matchIndices),r.classList.add(`quick-search-matched`),this.currentQuickSearchIndex>=0&&this.currentQuickSearchIndex<this.currentQuickSearchMatches.length&&this.currentQuickSearchMatches[this.currentQuickSearchIndex].rowIndex===t&&this.currentQuickSearchMatches[this.currentQuickSearchIndex].columnId===n.columnId&&r.classList.add(`quick-search-current-match`))}))}destroy(){this.keyboardHandlerModule&&this.keyboardHandlerModule.detach(),this.commandPalette&&this.commandPalette.isPaletteOpen()&&this.commandPalette.close(),this.modifierKeyTracker&&this.modifierKeyTracker.detach(),this.resizeObserver&&=(this.resizeObserver.disconnect(),null),this.virtualizerCleanup&&=(this.virtualizerCleanup(),null),this.scrollElement&&this.container.contains(this.scrollElement)&&this.container.removeChild(this.scrollElement),this.scrollElement=null,this.gridElement=null,this.headerElement=null,this.bodyElement=null,this.rowVirtualizer=null,this.statusBar&&=(this.statusBar.destroy(),null),this.vimKeyboardHandler&&=(document.removeEventListener(`keydown`,this.vimKeyboardHandler),null),this.commandLine&&=(this.commandLine.destroy(),null),this.vimCommandTracker&&=(this.vimCommandTracker.clear(),null)}initStatusBar(){this.statusBar=new xt(this.container,{onStatusUpdate:()=>{}}),this.statusBar.create(),this.updateStatusBar()}async executeCommandLineCommand(e){let t=e.trim();if(!t)return;let n=t.split(/\s+/),r=n[0].toLowerCase(),i=n.slice(1);if((r===`goto`||r===`go`)&&i.length>0){let e=i[0].toLowerCase();if(e===`top`||e===`first`||e===`1`){this.gotoTop();return}if(e===`bottom`||e===`last`){this.gotoBottom();return}let t=parseInt(i[0],10);if(!isNaN(t)&&t>0){this.gotoRow(t-1);return}}let a=this.commandRegistry.getCommands(`all`).find(e=>{let t=e.id.toLowerCase(),n=e.label.toLowerCase();return t===r||n.includes(r)||e.keywords?.some(e=>e.toLowerCase()===r)});a?a.execute(i):O.warn(`CommandLine: Unknown command: ${r}`)}updateStatusBar(){if(!this.statusBar)return;let e=this.cellEditor.getEditingCell()===null?`Normal`:`Editing`,t=this.focusManager.getFocusedCell(),n=this.getFilteredTranslations().length,r=t&&typeof t.rowIndex==`number`?t.rowIndex:null;n>0?r===null?r=0:r>=n&&(r=n-1):r=0;let i=t?t.columnId:null,a=this.changeTracker.getChanges().length,o=this.countEmptyTranslations(),s=this.countDuplicateKeys(),c=this.vimCommandTracker?.getCurrentCommand(),l=c?c.sequence:null;this.statusBar.update({mode:e,rowIndex:r,totalRows:n,columnId:i,changesCount:a,emptyCount:o,duplicateCount:s,command:l})}countEmptyTranslations(){let e=this.getFilteredTranslations(),t=0;return e.forEach(e=>{this.options.languages.forEach(n=>{let r=e.values[n]||``;(!r||typeof r==`string`&&r.trim()===``)&&t++})}),t}countDuplicateKeys(){let e=this.getFilteredTranslations(),t=new Map;e.forEach(e=>{let n=e.key.trim();n&&t.set(n,(t.get(n)||0)+1)});let n=0;return t.forEach(e=>{e>1&&(n+=e-1)}),n}};exports.ChangeTracker=k,exports.VirtualTableDiv=Et;