# Effect & Zod 성능 고려사항

## 성능 측정 결과

### 오버헤드 측정 (1000번 호출 기준)

| 메서드 | Effect 기반 | 최적화 버전 | 오버헤드 |
|--------|------------|-------------|---------|
| `getOriginalValue` | ~7.8ms | ~0.1ms | 약 77배 |
| `trackChange` | ~6.2ms | ~0.3ms | 약 20배 |

### 분석

1. **절대적인 성능**: 1000번 호출에 7-8ms는 여전히 매우 빠름
2. **상대적인 오버헤드**: 검증 없이 직접 Map 접근과 비교하면 큰 차이
3. **실제 사용 시나리오**: 
   - 셀 편집은 사용자 입력에 따라 발생 (초당 수십~수백 번 정도)
   - 절대적인 값이 작으므로 실제 사용에서는 체감하기 어려움

## 최적화 옵션

### 1. 프로덕션 환경에서 검증 비활성화

```typescript
// 프로덕션 환경에서는 검증을 비활성화
const tracker = new ChangeTracker({
  enableValidation: process.env.NODE_ENV !== "production"
});
```

**장점**:
- 프로덕션에서 최고 성능
- 개발 환경에서는 여전히 type-safe 검증

**단점**:
- 프로덕션에서 잘못된 데이터로 인한 에러 발견이 어려움

### 2. 기본 설정 (현재 구현)

- 개발 환경 (`NODE_ENV !== "production"`): 검증 활성화
- 프로덕션 환경: 검증 비활성화

### 3. 언제 검증을 사용해야 할까?

**검증 활성화 권장**:
- 개발/테스트 환경
- 외부 데이터 소스에서 데이터를 받는 경우
- API나 파일에서 로드한 데이터를 처리하는 경우

**검증 비활성화 고려**:
- 이미 검증된 데이터 (예: TypeScript 타입 체크 통과)
- 성능이 중요한 경로 (예: 스크롤, 렌더링 루프)
- 내부적으로만 사용되는 메서드

## 권장사항

1. **기본값 사용**: 개발 환경에서는 검증 활성화, 프로덕션에서는 비활성화
2. **성능이 중요한 경우**: 명시적으로 `enableValidation: false` 설정
3. **안정성이 중요한 경우**: `enableValidation: true` 유지

## 성능 목표

현재 구현은 다음 성능 목표를 충족합니다:

- ✅ `getOriginalValue`: 1000번 호출 < 10ms (검증 활성화 시)
- ✅ `trackChange`: 1000번 호출 < 50ms (검증 활성화 시)
- ✅ 검증 비활성화 시: 거의 오버헤드 없음

## 결론

Effect와 Zod를 사용한 검증은 type-safe한 에러 처리를 제공하지만 성능 오버헤드가 있습니다. 
하지만 절대적인 값이 작고, 프로덕션 환경에서는 검증을 비활성화할 수 있는 옵션을 제공하므로 
실제 사용에서 문제가 될 가능성은 낮습니다.

