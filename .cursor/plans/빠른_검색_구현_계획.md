# 빠른 검색 (Quick Search) 구현 계획

## 목표

- `/` 키로 검색 모드 진입
- 실시간 하이라이트
- `n`/`N`으로 다음/이전 매칭 이동
- 검색 결과 수 표시
- 컬럼별 검색 (`/key:keyword`, `/en:keyword` 등)

## 아키텍처

### 컴포넌트 구조

```
src/components/
  quick-search.ts          # QuickSearch 모듈 (검색 상태, 파싱, 매칭)
  quick-search-ui.ts       # 검색 UI 컴포넌트 (검색 바, 결과 표시)
src/styles/
  quick-search.css         # 검색 UI 스타일
```

### 검색어 파싱

```
/keyword                    # 모든 컬럼에서 검색
/key:keyword                # Key 컬럼만
/context:keyword            # Context 컬럼만
/en:keyword                 # EN 언어만
/ko:keyword                 # KO 언어만
```

### 상태 관리

- `isSearchMode`: 검색 모드 활성화 여부
- `searchQuery`: 현재 검색어
- `searchColumn`: 검색 대상 컬럼 (null이면 전체)
- `matches`: 검색 결과 매칭 목록
- `currentMatchIndex`: 현재 매칭 인덱스

## 구현 단계

### Phase 1: 핵심 기능

1. **QuickSearch 모듈 생성**
   - 검색어 파싱 (`parseSearchQuery`)
   - 컬럼별 검색 파싱 (`/key:keyword` 형식)
   - 검색 매칭 로직
   - 매칭 결과 반환

2. **검색 UI 구현**
   - `/` 키 입력 시 검색 바 표시
   - 검색어 입력 필드
   - 검색 결과 수 표시 (예: "3/10 matches")
   - Escape로 검색 모드 종료

3. **실시간 검색 및 하이라이트**
   - 검색어 입력 시 즉시 검색 실행
   - 매칭된 셀 하이라이트
   - 검색어 하이라이트 (텍스트 내)

### Phase 2: 네비게이션

4. **n/N 키로 매칭 이동**
   - `n` 키: 다음 매칭으로 이동
   - `N` 키: 이전 매칭으로 이동
   - 순환 네비게이션 (마지막→첫 번째, 첫 번째→마지막)
   - 현재 매칭으로 스크롤 및 포커스

### Phase 3: 테스트

5. **단위 테스트**
   - QuickSearch 모듈 테스트
   - 검색어 파싱 테스트
   - 컬럼별 검색 테스트
   - 매칭 로직 테스트

6. **E2E 테스트**
   - `/` 키 입력 테스트
   - 검색 실행 테스트
   - `n`/`N` 키 이동 테스트
   - 컬럼별 검색 테스트
   - Escape로 종료 테스트

## 구현 세부사항

### QuickSearch 모듈

```typescript
export interface SearchQuery {
  keyword: string;
  column?: string; // 'key', 'context', 'en', 'ko' 등
}

export interface SearchMatch {
  rowIndex: number;
  columnId: string;
  matchedText: string;
  matchIndices: number[]; // 하이라이트할 문자 인덱스
}

export class QuickSearch {
  parseQuery(query: string): SearchQuery | null;
  findMatches(
    query: SearchQuery,
    translations: Translation[],
    languages: string[]
  ): SearchMatch[];
  highlightText(text: string, indices: number[]): string;
}
```

### 검색 UI

- 검색 바는 그리드 상단 또는 하단에 표시
- 검색어 입력 필드
- 검색 결과 수 표시
- Escape로 닫기

### 하이라이트

- 매칭된 셀에 배경색 적용
- 검색어 텍스트에 하이라이트 스타일 적용
- 현재 매칭 위치 강조

## 테스트 계획

### 단위 테스트

1. `parseQuery` 테스트
   - `/keyword` → `{ keyword: 'keyword' }`
   - `/key:keyword` → `{ keyword: 'keyword', column: 'key' }`
   - `/en:keyword` → `{ keyword: 'keyword', column: 'en' }`

2. `findMatches` 테스트
   - 전체 컬럼 검색
   - 컬럼별 검색
   - 대소문자 무시
   - 부분 일치

3. `highlightText` 테스트
   - 하이라이트 인덱스 적용
   - HTML 이스케이프 처리

### E2E 테스트

1. `/` 키 입력 시 검색 바 표시
2. 검색어 입력 시 실시간 검색
3. `n` 키로 다음 매칭 이동
4. `N` 키로 이전 매칭 이동
5. 컬럼별 검색 (`/key:keyword`)
6. Escape로 검색 모드 종료
7. 검색 결과 수 표시

## 다음 단계

1. QuickSearch 모듈 생성 및 단위 테스트 작성
2. 검색 UI 구현
3. 실시간 검색 및 하이라이트 구현
4. n/N 키 네비게이션 구현
5. E2E 테스트 작성



